<!DOCTYPE html
  SYSTEM "about:legacy-compat">

<!-- saved from url=(0023)https://docs.oracle.com -->

<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Building a Database Access Class</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="2 Day + PHP Developer's Guide">
      <meta property="og:description" content="">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="2 Day + PHP Developer's Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 17.8.1">
      <link rel="alternate" href="2-day-php-developers-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2017-10-18T11:39:07-07:00">
      <meta name="dcterms.title" content="2 Day + PHP Developer's Guide">
      <meta name="dcterms.dateCopyrighted" content="2010, 2017">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E85807-01">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/12.2">
      <meta name="dcterms.release" content="Release 12.2">
      <link rel="prev" href="getting-started.html" title="Previous" type="text/html">
      <link rel="next" href="building-AnyCo-application.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">
            {
                "primary":
                {
                    "category":{
                      "short_name":"database",
                      "element_name":"Database",
                      "display_in_url":true
                    },
                    "suite":{
                      "short_name":"oracle",
                      "element_name":"Oracle",
                      "display_in_url":true
                    },
                    "product_group":{
                      "short_name":"not-applicable",
                      "element_name":"Not applicable",
                      "display_in_url":false
                    },
                    "product":{
                      "short_name":"oracle-database",
                      "element_name":"Oracle Database",
                      "display_in_url":true
                    },
                    "release":{
                      "short_name":"12.2",
                      "element_name":"Release 12.2",
                      "display_in_url":true
                    },
                    "platform":{
                      "short_name":"",
                      "element_name":"",
                      "display_in_url":false
                    },
                    "component":{
                      "short_name":"",
                      "element_name":"",
                      "display_in_url":false
                    }
                }
            }
            </script>
      
    <meta name="dcterms.isVersionOf" content="TDPPH">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="getting-started.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="building-AnyCo-application.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">2 Day + PHP Developer's Guide</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Building a Database Access Class </li>
            </ol>
            <a id="GUID-2A7AFA87-53BC-453A-B23B-BC178AA6E528" name="GUID-2A7AFA87-53BC-453A-B23B-BC178AA6E528"></a><a id="TDPPH147"></a>
            
            <h2 id="TDPPH-GUID-2A7AFA87-53BC-453A-B23B-BC178AA6E528" class="sect2"><span class="enumeration_chapter">3 </span>Building a Database Access Class 
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>The Oracle database functionality for the AnyCo application will be abstracted into a class that handles all PHP OCI8 access.</p>
               <p>This chapter contains the following topics:</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="building-database-access-class.html#GUID-3CF00CE2-3B9D-4E7E-B351-66B392453605">Connection Constants</a></p>
                  </li>
                  <li>
                     <p><a href="building-database-access-class.html#GUID-B97F0D26-183D-4AD7-A42D-C3D7F0D15531">Creating the Db class</a></p>
                  </li>
                  <li>
                     <p><a href="building-database-access-class.html#GUID-3EED6CBA-8FE7-4C29-BC2C-A1BED5154560">General Example of Running SQL in PHP OCI8</a></p>
                  </li>
                  <li>
                     <p><a href="building-database-access-class.html#GUID-0082911D-ECDB-4EF1-83BF-430DAF3C7A40">Running SQL with the Db Class</a></p>
                  </li>
                  <li>
                     <p><a href="building-database-access-class.html#GUID-F70C51C2-6AEA-4D1A-94ED-34D8643E37DB">Testing the Db Class</a></p>
                  </li>
               </ul>
            </div><a id="TDPPH148"></a><div class="props_rev_3"><a id="GUID-3CF00CE2-3B9D-4E7E-B351-66B392453605" name="GUID-3CF00CE2-3B9D-4E7E-B351-66B392453605"></a><h3 id="TDPPH-GUID-3CF00CE2-3B9D-4E7E-B351-66B392453605" class="sect3"><span class="enumeration_section">3.1 </span>Connection Constants
               </h3>
               <div>
                  <p>Create a PHP file <code class="codeph">ac_cred.inc.php</code>. The '.inc' component of the name is a common convention indicating that the file only contains definitions such as functions or classes. Giving it a final <code class="codeph">.php</code> extension means that if a user somehow makes a HTTP request for that file, the web server will not send its text to the user (a security risk) but will run it as a PHP script. Because the file only contains definitions there will be no output sent to the user. This will prevent undesirable results or code exposure.
                  </p>
                  <p>The <code class="codeph">ac_cred.inc.php</code> file should initially look like:
                  </p><pre class="oac_no_warn" dir="ltr">&lt;?php
 
/**
 * ac_cred.inc.php: Secret Connection Credentials for a database class
 * @package Oracle
 */
 
/**
 * DB user name
 */
define('SCHEMA', 'hr');
 
/**
 * DB Password.
 *
 * Note: In practice keep database credentials out of directories
 * accessible to the web server.
 */
define('PASSWORD', 'welcome');
 
/**
 * DB connection identifier
 */
define('DATABASE', 'localhost:pooled');
 
/**
 * DB character set for returned data
 */
define('CHARSET', 'UTF8');
 
/**
 * Client Information text for DB tracing
 */
define('CLIENT_INFO', 'AnyCo Corp.');
 
?&gt;
</pre><p>To connect to an Oracle DB requires a user name, password, and a string identifying the DB to which to connect. These are set as the constants <code class="codeph">SCHEMA</code>, <code class="codeph">PASSWORD</code>, and <code class="codeph">DATABASE</code> using PHP's <code class="codeph">define()</code> command. A character set is an optional but recommended connection parameter. Here UTF8 is chosen in the <code class="codeph">CHARSET</code> constant.
                  </p>
                  <p>Most PHP applications connect to the DB using one constant database account. In this example the database user is HR. This has some security implications that should not be discounted. Even though the file has the .<code class="codeph">php</code> extension, in practice it is recommended to keep any files containing credentials or other sensitive information out of directories that Apache can access, and use PHP's <code class="codeph">require()</code> command to load them. To avoid hard coding credentials in a file, some sites require applications read the values from environment variables set prior to starting Apache.
                  </p>
                  <p>The database connection syntax used in DATABASE is Oracle's "Easy Connect" syntax. This specifies the host name where the database is running and identifies the service name of the database. Here the machine is given as <code class="codeph">localhost</code>, meaning that PHP and the database need to be on the same machine. The <code class="codeph">:pooled</code> suffix says that the connection should use the DRCP pool. If you did not start the DRCP pool in the section “Post PHP Installation Tasks on Windows and Linux”, then omit this suffix and change <code class="codeph">DATABASE</code> to <code class="codeph">localhost</code>. This is the only application change that is necessary to determine whether or not to use DRCP.
                  </p>
                  <p>A connection identifier could also be an Oracle Net <code class="codeph">tnsnames.ora</code> alias, depending on your site standards.
                  </p>
                  <p>The <code class="codeph">CLIENT_INFO</code> constant will be used for end-to-end application tracing in the database. This is discussed in “Monitoring Database Usage of the Application”.
                  </p>
               </div>
            </div><a id="TDPPH149"></a><div class="props_rev_3"><a id="GUID-B97F0D26-183D-4AD7-A42D-C3D7F0D15531" name="GUID-B97F0D26-183D-4AD7-A42D-C3D7F0D15531"></a><h3 id="TDPPH-GUID-B97F0D26-183D-4AD7-A42D-C3D7F0D15531" class="sect3"><span class="enumeration_section">3.2 </span>Creating the Db class
               </h3>
               <div>
                  <div class="section">
                     <p>Create a new PHP file <code class="codeph">ac_db.inc.php</code> to hold a database access class. Initially the file contains:
                     </p><pre class="oac_no_warn" dir="ltr">&lt;?php
 
/**
 * ac_db.inc.php: Database class using the PHP OCI8 extension
 * @package Oracle
 */
 
namespace Oracle;
 
require('ac_cred.inc.php');
 
/**
 * Oracle Database access methods
 * @package Oracle
 * @subpackage Db
 */
class Db {
 
    /**
     * @var resource The connection resource
     * @access protected
     */
    protected $conn = null;
    /**
     * @var resource The statement resource identifier
     * @access protected
     */
    protected $stid = null;
    /**
     * @var integer The number of rows to prefetch with queries
     * @access protected
     */
    protected $prefetch = 100;
 
}
 
?&gt;
</pre><p>The <code class="codeph">ac_db.inc.php</code> file sets the namespace to Oracle, defining the namespace of classes declared or used in the file. This avoids clashes if there are different implementations of classes in an application that happen to have the same name.
                     </p>
                     <p>The database credentials are included with <code class="codeph">require()</code>. If a required file does not exist a compilation error will occur. PHP also has an <code class="codeph">include()</code> function that will not display an error for a missing file. Variants <code class="codeph">require_once()</code> and <code class="codeph">include_once()</code> can be used to prevent a sub file from being included more than once.
                     </p>
                     <p>The <code class="codeph">Db</code> class attributes will be discussed soon.
                     </p>
                     <p>The comments are in a format that the open source tool PHPDocumentor will parse, for example <code class="codeph">@package</code> defines the overall package that this file belongs to. NetBeans 7.0 can use these tags to automatically generate application documentation.
                     </p>
                     <p>Add the following two methods into the <code class="codeph">Db </code>class, between the <code class="codeph">$prefetch</code> attribute and the closing brace:
                     </p><pre class="oac_no_warn" dir="ltr">   /**
     * Constructor opens a connection to the database
     * @param string $module Module text for End-to-End Application Tracing
     * @param string $cid Client Identifier for End-to-End Application Tracing
     */
    function __construct($module, $cid) {
        $this-&gt;conn = @oci_pconnect(SCHEMA, PASSWORD, DATABASE, CHARSET);
        if (!$this-&gt;conn) {
            $m = oci_error();
            throw new \Exception('Cannot connect to database: ' . $m['message']);
        }
        // Record the "name" of the web user, the client info and the module.
        // These are used for end-to-end tracing in the DB.
        oci_set_client_info($this-&gt;conn, CLIENT_INFO);
        oci_set_module_name($this-&gt;conn, $module);
        oci_set_client_identifier($this-&gt;conn, $cid);
    }
 
    /**
     * Destructor closes the statement and connection
     */
    function __destruct() {
        if ($this-&gt;stid)
            oci_free_statement($this-&gt;stid);
        if ($this-&gt;conn)
            oci_close($this-&gt;conn);
    }
</pre><p>When a PHP object instance is created its <code class="codeph">__construct()</code> method will be called. The <code class="codeph">Db</code> class constructor opens a connection to Oracle Database and keeps the connection resource in the <code class="codeph">$conn</code> attribute for use when running statements. If connection does not succeed an error is generated. This error will be displayed to the user if PHP's <code class="codeph">php.ini</code> parameter <code class="codeph">display_errors</code> is <code class="codeph">On</code> and sent to the Apache log files if <code class="codeph">log_errors</code> is <code class="codeph">On</code>. In the section “Post PHP Installation Tasks on Windows and Linux”, <code class="codeph">display_errors</code> was set to <code class="codeph">On</code> to help development. A production application should never display errors to the user because this is an information security leak.
                     </p>
                     <p>The constructor passes the connection credentials to an <code class="codeph">oci_pconnect()</code> function. The AnyCo application uses <code class="codeph">oci_pconnect()</code> to create a "persistent" DRCP connection, as described in “Database Resident Connection Pooling”.
                     </p>
                     <p>The character set is also passed to <code class="codeph">oci_pconnect()</code>. It specifies the character set that data will be in when returned from Oracle to PHP. Setting it is optional but recommended. If the character set is not passed to <code class="codeph">oci_pconnect()</code>, then PHP will determine the character set from the environment settings, which can be slower and may lead to an unexpected value being used.
                     </p>
                     <p>A consequence of using the one database user name is that all statements in the application are recorded in the database as being run by HR. This makes analysis and tracing difficult or impossible. The <code class="codeph">oci_set_client_identifier()</code> function allows an arbitrary string to be recorded with the connection and processed statement details in the database. By setting the identifier to the name of the web user this allows DBAs to explicitly associate an end user with database usage. The following article describes in detail where client identifiers can be used in Oracle Database: 
                     </p>
                     <p><a href="http://www.oracle.com/technetwork/articles/dsl/php-web-auditing-171451.html"><code class="codeph">http://www.oracle.com/technetwork/articles/dsl/php-web-auditing-171451.html</code></a></p>
                     <p>Also to aid database tracing, two other pieces of metadata are set for each connection: the Client Information and the Module Name. “Monitoring Database Usage of the Application” shows where they are useful.</p>
                     <p>If a connection error occurs, an exception is thrown. The Exception class name is fully qualified. If the leading '<code class="codeph">\</code>' was removed then an attempt to call <code class="codeph">\Oracle\Exception</code> would occur, causing a run time error because a class called Exception has not been defined in the Oracle namespace. The namespace separator in PHP is a backslash(\) because it was the only feasible character available when namespaces were introduced in PHP 5.3.
                     </p>
                     <p>The <code class="codeph">Db </code>instance destructor explicitly closes any open connection. For a persistent DRCP pooled connection like shown, this returns the database server process to the DRCP pool for reuse. Because PHP variables internally use a reference counting mechanism, any variable that increases the reference count on the connection resource must be freed before the underlying database connection will be physically closed. Here this means closing the statement resource, which is used later in this manual when the class is enhanced to run statements.
                     </p>
                     <p>Because of PHP's reference counting mechanism, the destructor shown simply emulates the default behavior when an instance of the object is destroyed. Statement and connection resources will be terminated when variables referencing them are destroyed. This particular implementation of the destructor could therefore be omitted.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="getting-started.html#GUID-BF19D89D-9ED6-4C16-AD60-410B6C08E047">Post PHP Installation Tasks on Windows and Linux</a></li>
                        <li><a href="getting-started.html#GUID-2FCEF7C5-6229-42A8-A4CB-09358A32FBE3">Database Resident Connection Pooling</a></li>
                        <li><a href="monitoring-database-usage-of-application.html#GUID-D8B6047B-5B6E-40D7-AA47-C985EA00D75B">Monitoring Database Usage of the Application</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="TDPPH150"></a><div class="props_rev_3"><a id="GUID-3EED6CBA-8FE7-4C29-BC2C-A1BED5154560" name="GUID-3EED6CBA-8FE7-4C29-BC2C-A1BED5154560"></a><h3 id="TDPPH-GUID-3EED6CBA-8FE7-4C29-BC2C-A1BED5154560" class="sect3"><span class="enumeration_section">3.3 </span>General Example of Running SQL in PHP OCI8
               </h3>
               <div>
                  <p>Running a statement in PHP OCI8 involves parsing the statement text and running it. In procedural style an <code class="codeph">INSERT</code> would look like:
                  </p><pre class="oac_no_warn" dir="ltr">    $c = oci_pconnect($un, $pw, $db, $cs);
    $sql = "INSERT INTO mytable (c1, c2) VALUES (1, 'abc')";
    $s = oci_parse($c, $sql);
    oci_execute($s);
</pre><p>If a statement will be re-run in the database system with different data values, then use bind variables:</p><pre class="oac_no_warn" dir="ltr">    $c = oci_pconnect($un, $pw, $db, $cs);
    $sql = "INSERT INTO mytable (c1, c2) VALUES (:c1_bv, :c2_bv)";
    $s = oci_parse($c, $sql);
    $c1 = 1;
    $c2 = 'abc';
    oci_bind_by_name($s, ":c1_bv", $c1, -1);
    oci_bind_by_name($s, ":c2_bv", $c2, -1);
    oci_execute($s);
</pre><p>Binding associates PHP variables with the bind identifier place holders in the SQL statement. The bind lengths are set to <code class="codeph">-1</code> telling PHP to infer internal buffer sizes from the lengths of the PHP values. When using <code class="codeph">oci_bind_by_name()</code> to return data from the database (such as when assigning a PL/SQL function return value to a bind variable), the actual expected data length should be specified so enough internal space can be allocated for the PHP variable.
                  </p>
                  <p>Bind variables are important for performance and security reasons. They allow the database to reuse statement metadata for repeated statements where only the variable values change. An alternative PHP coding style would concatenate PHP variable values into the SQL statement text. Each such statement would appear unique to the DB and caching would be reduced. This severely impacts DB performance. Also concatenation introduces SQL Injection security risks, where concatenation with malicious user input changes the semantics of the SQL statement.</p>
                  <p>In PHP, a SQL query is similar to execution but has a subsequent fetch call, of which PHP has several variants. For example to fetch all rows at once:</p><pre class="oac_no_warn" dir="ltr">    $c = oci_pconnect($un, $pw, $db, $cs);
    $sql = "SELECT * FROM mytable WHERE c1 = :c1_bv AND c2 = :c2_bv";
    $s = oci_parse($c, $sql);
    $c1 = 1;
    $c2 = 'abc';
    oci_bind_by_name($s, ":c1_bv", $c1, -1);
    oci_bind_by_name($s, ":c2_bv", $c2, -1);
    oci_execute($s);
    oci_fetch_all($s, $res, 0, -1, OCI_FETCHSTATEMENT_BY_ROW);
</pre><p>The query results would be in <code class="codeph">$res</code>. The <code class="codeph">OCI_FETCHSTATEMENT_BY_ROW</code> constant indicates the results will be in an array with entries for each row. The rows themselves are represented by a sub-arrays.
                  </p>
                  <p>If the query returns a large number of rows the memory use might be undesirably large. Other PHP OCI8 functions like <code class="codeph">oci_fetch_array()</code> could be called instead. This function returns only one row of the result set. After the script has processed the row, it could call <code class="codeph">oci_fetch_array()</code> again to fetch the next row.
                  </p>
                  <div class="infoboxnote" id="GUID-3EED6CBA-8FE7-4C29-BC2C-A1BED5154560__GUID-9987908F-B980-4384-8584-AD72FB568D8E">
                     <p class="notep1">Note:</p>
                     <p>The bind variable name argument in an <code class="codeph">oci_bind_by_name()</code> call does not need to have a colon prefix, but it can help visual code inspection to include it.
                     </p>
                  </div>
               </div>
            </div><a id="TDPPH151"></a><div class="props_rev_3"><a id="GUID-0082911D-ECDB-4EF1-83BF-430DAF3C7A40" name="GUID-0082911D-ECDB-4EF1-83BF-430DAF3C7A40"></a><h3 id="TDPPH-GUID-0082911D-ECDB-4EF1-83BF-430DAF3C7A40" class="sect3"><span class="enumeration_section">3.4 </span>Running SQL with the Db Class
               </h3>
               <div>
                  <div class="section">
                     <p>To make our <code class="codeph">Db </code>class in <code class="codeph">ac_db.inc.php</code> useful add these two methods to the class:
                     </p><pre class="oac_no_warn" dir="ltr"> /**
     * Run a SQL or PL/SQL statement
     *
     * Call like:
     *     Db::execute("insert into mytab values (:c1, :c2)",
     *                 "Insert data", array(array(":c1", $c1, -1),
     *                                      array(":c2", $c2, -1)))
     *
     * For returned bind values:
     *     Db::execute("begin :r := myfunc(:p); end",
     *                 "Call func", array(array(":r", &amp;$r, 20),
     *                                    array(":p", $p, -1)))
     *
     * Note: this performs a commit.
     *
     * @param string $sql The statement to run
     * @param string $action Action text for End-to-End Application Tracing
     * @param array $bindvars Binds. An array of (bv_name, php_variable, length)
     */
    public function execute($sql, $action, $bindvars = array()) {
        $this-&gt;stid = oci_parse($this-&gt;conn, $sql);
        if ($this-&gt;prefetch &gt;= 0) {
            oci_set_prefetch($this-&gt;stid, $this-&gt;prefetch);
        }
        foreach ($bindvars as $bv) {
            // oci_bind_by_name(resource, bv_name, php_variable, length)
            oci_bind_by_name($this-&gt;stid, $bv[0], $bv[1], $bv[2]);
        }
        oci_set_action($this-&gt;conn, $action);
        oci_execute($this-&gt;stid);              // will auto commit
    }
 
    /**
     * Run a query and return all rows.
     *
     * @param string $sql A query to run and return all rows
     * @param string $action Action text for End-to-End Application Tracing
     * @param array $bindvars Binds. An array of (bv_name, php_variable, length)
     * @return array An array of rows
     */
    public function execFetchAll($sql, $action, $bindvars = array()) {
        $this-&gt;execute($sql, $action, $bindvars);
        oci_fetch_all($this-&gt;stid, $res, 0, -1, OCI_FETCHSTATEMENT_BY_ROW);
        $this-&gt;stid = null;  // free the statement resource
        return($res);
    }
</pre><p>These methods do the same as the previous procedural samples, with the addition of another piece of database tracing metadata called the Action, and a way to tune performance of queries, called prefetching. Prefetching is discussed later in “Query Performance and Prefetching”.</p>
                     <p>All the tracing metadata set in the <code class="codeph">Db </code>class is optional, however it is easier to include it in the design instead of having to retrofit it. It can be painful to troubleshoot performance or access issues on production applications without it.
                     </p>
                     <p>Setting the statement identifier resource <code class="codeph">$this-&gt;stid</code> to null initiates the same internal cleanup as <code class="codeph">oci_free_statement()</code> (used in the destructor) and also sets the attribute to null so later methods can test for validity.
                     </p>
                     <p>Our <code class="codeph">Db::execute()</code> method allows us to write our <code class="codeph">INSERT</code> statement as:
                     </p><pre class="oac_no_warn" dir="ltr">    $db = new \Oracle\Db("Test Example", "Chris");
    $sql = "INSERT INTO mytable (c1, c2) VALUES (:c1_bv, :c2_bv)";
    $c1 = 1;
    $c2 = 'abc';
    $db-&gt;execute($sql, "Insert Example", array(array(":c1_bv", $c1, -1),
                                               array(":c2_bv", $c2, -1)));
</pre><p>The query example would be:</p><pre class="oac_no_warn" dir="ltr">    $db = new \Oracle\Db("Test Example", "Chris");
    $sql = "SELECT * FROM mytable WHERE c1 = :c1_bv AND c2 = :c2_bv";
    $c1 = 1;
    $c2 = 'abc';
    $res = $db-&gt;execFetchAll($sql, "Query Example", 
                             array(array(":c1_bv", $c1, -1),
                                   array(":c2_bv", $c2, -1)));
</pre><p>The <code class="codeph">Db</code> instance creation uses a fully qualified namespace description.
                     </p>
                     <p>The bind variables are encapsulated in an array of arrays. Each sub-array describes one bind variable.</p>
                     <p>As coded, the <code class="codeph">Db</code> class automatically commits each time <code class="codeph">oci_execute()</code> it is called. This has performance and transactional consistency implications if the class is to be reused in future applications. To make <code class="codeph">Db</code> more general purpose you could consider changing <code class="codeph">Db::execute()</code> to do:
                     </p><pre class="oac_no_warn" dir="ltr">        ...
        oci_execute($this-&gt;stid, OCI_NO_AUTO_COMMIT);
        ...
</pre><p>In this case you would need to add <code class="codeph">commit</code> and <code class="codeph">rollback</code> methods to the <code class="codeph">Db</code> class that call <code class="codeph">oci_commit()</code> and <code class="codeph">oci_rollback()</code> respectively. The examples in this manual do not require these changes. Note that in PHP any <code class="codeph">oci_connect()</code> or any <code class="codeph">oci_pconnect() </code>call that uses the same connection credentials will reuse the same underlying connection to the database. So if an application creates two instances of <code class="codeph">Db</code>, they will share the same transaction state. Rolling back or committing one instance will affect transactions in the other. The <code class="codeph">oci_new_connect()</code> function is different and will create its own new connection each time it is called.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="query-performance-prefetching.html#GUID-316BD918-0A9A-4321-AC6D-9AE67F565F95">Query Performance and Prefetching</a></li>
                     </ul>
                  </div>
               </div>
               
            </div><a id="TDPPH152"></a><div class="props_rev_3"><a id="GUID-F70C51C2-6AEA-4D1A-94ED-34D8643E37DB" name="GUID-F70C51C2-6AEA-4D1A-94ED-34D8643E37DB"></a><h3 id="TDPPH-GUID-F70C51C2-6AEA-4D1A-94ED-34D8643E37DB" class="sect3"><span class="enumeration_section">3.5 </span>Testing the Db Class
               </h3>
               <div>
                  <div class="section">
                     <p>Test the <code class="codeph">Db </code>class by creating a new PHP file called <code class="codeph">test_db.php</code>:
                     </p><pre class="oac_no_warn" dir="ltr">&lt;?php
 
// test_db.php
 
require('ac_db.inc.php');
 
$db = new \Oracle\Db("test_db", "Chris");
$sql = "SELECT first_name, phone_number FROM employees ORDER BY employee_id";
$res = $db-&gt;execFetchAll($sql, "Query Example");
// echo "&lt;pre&gt;"; var_dump($res); echo "&lt;/pre&gt;\n";
 
echo "&lt;table border='1'&gt;\n";
echo "&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Phone Number&lt;/th&gt;&lt;/tr&gt;\n";
foreach ($res as $row) {
    $name = htmlspecialchars($row['FIRST_NAME'], ENT_NOQUOTES, 'UTF-8');
    $pn   = htmlspecialchars($row['PHONE_NUMBER'], ENT_NOQUOTES, 'UTF-8');
    echo "&lt;tr&gt;&lt;td&gt;$name&lt;/td&gt;&lt;td&gt;$pn&lt;/td&gt;&lt;/tr&gt;\n";
}
echo "&lt;/table&gt;";
 
?&gt;
</pre><p>The <code class="codeph">require() </code>command includes the content of <code class="codeph">ac_db.inc.php</code> giving the script access to the <code class="codeph">Db </code>class.
                     </p>
                     <p>The module name parameter for the <code class="codeph">Db </code>instance creation is set to the file name base <code class="codeph">test_db</code>. This allows anyone doing database tracing to identify where the connection was initiated from. The connection identifier is arbitrarily set to a fictitious user's name. The Action parameter to <code class="codeph">$db-&gt;execFetchAll()</code> is set to the operation in the file.
                     </p>
                     <p>No bind variables are passed in this example so the optional bind parameter is not specified in the <code class="codeph">$db-&gt;execFetchAll()</code> method call. The definition of <code class="codeph">Db::execFetchAll()</code> sets the bind variable list to an empty array when there is no final argument and therefore will not attempt to bind any data.
                     </p>
                     <p>The query results are returned in<code class="codeph"> $res</code> as an array of row data. You can see the array structure by un-commenting the <code class="codeph">var_dump()</code> function, which is useful for simple PHP debugging. The <code class="codeph">$res</code> array is iterated over in a <code class="codeph">foreach()</code> loop that process each row in turn. The two columns in each row's sub-array are accessed by <code class="codeph">$row['FIRST_NAME']</code> and <code class="codeph">$row['PHONE_NUMBER']</code>. By default, columns in Oracle database tables are case insensitive. They will be returned to PHP as upper case array indices. If the table had been created in Oracle with case a sensitive column name like
                     </p><pre class="oac_no_warn" dir="ltr">CREATE TABLE mytab ("MyCol" NUMBER);
</pre><p>then in PHP you would need to use a case sensitive array index <code class="codeph">$row['MyCol']</code>.
                     </p>
                     <p>In <code class="codeph">test_db.php</code>, the returned data is processed with <code class="codeph">htmlspecialchars()</code> to make sure that any text that happens to look like HTML is treated as displayable text and not as HTML markup. This escaping of output is very important for security in web applications to make sure there are no cross-site scripting (XSS) security issues.
                     </p>
                     <p>The exact <code class="codeph">htmlspecialchars()</code> options you use would depend on context. PHP also has an <code class="codeph">htmlentities() </code>function that might be useful. The character set should match the HTML page character set. The AnyCo application will do this.
                     </p>
                     <p>Load <code class="codeph">test_db.php</code> in a browser: <code class="codeph">http://localhost/test_db.php</code>. Or, in NetBeans, right click on the file in the <span class="bold">Projects</span> navigator and select <span class="bold">Run</span>.
                     </p>
                     <p>It displays:</p>
                     <div class="figure" id="GUID-F70C51C2-6AEA-4D1A-94ED-34D8643E37DB__GUID-F86EAFF7-0D1B-43A8-8CE4-F69C63C5DA1B"><img src="img/chap3_test_db_class.png" width="154" alt="figure" title="figure"></div>
                     <!-- class="figure" -->
                     <p>If you have problems connecting, resolve any PHP interpreter errors. Make sure all methods are located inside the class definition braces. Review the section “Testing PHP Connections to Oracle” for other common problems.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div>
                  <div class="relinfo">
                     <p><strong>Related Topics</strong></p>
                     <ul>
                        <li><a href="getting-started.html#GUID-8DE3EC83-1C6E-4B93-8937-5A0A5E094256">Testing PHP Connections to Oracle</a></li>
                     </ul>
                  </div>
               </div>
               
            </div>
         </div>
      </article>
   </body>
</html>