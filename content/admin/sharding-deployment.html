<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="Sharded database deployment includes the prerequisites and instructions for installing the required software components, creating the catalog, roles, and the sharded database, configuring replication for high availability, and creating the schema for the sharded database.">
      <meta name="description" content="Sharded database deployment includes the prerequisites and instructions for installing the required software components, creating the catalog, roles, and the sharded database, configuring replication for high availability, and creating the schema for the sharded database.">
      <title>Sharded Database Deployment</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database Administrator’s Guide ">
      <meta property="og:description" content="Sharded database deployment includes the prerequisites and instructions for installing the required software components, creating the catalog, roles, and the sharded database, configuring replication for high availability, and creating the schema for the sharded database.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database Administrator’s Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="database-administrators-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-03-29T07:20:19-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2001, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E85760-06">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/12.2">
      <meta name="dcterms.release" content="Release 12.2">
      <link rel="prev" href="sharding-high-availability.html" title="Previous" type="text/html">
      <link rel="next" href="sharding-lifecycle-management.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"database","element_name":"Database","display_in_url":true},"suite":{"short_name":"oracle","element_name":"Oracle","display_in_url":true},"product_group":{"short_name":"not-applicable","element_name":"Not applicable","display_in_url":false},"product":{"short_name":"oracle-database","element_name":"Oracle Database","display_in_url":true},"release":{"short_name":"12.2","element_name":"Release 12.2","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Database Administrator's Guide">
    <meta name="dcterms.isVersionOf" content="ADMIN">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="sharding-high-availability.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="sharding-lifecycle-management.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database Administrator’s Guide </span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="shard_part.html" property="item" typeof="WebPage"><span property="name">Sharded Database Management</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Sharded Database Deployment</li>
            </ol>
            <a id="GUID-F99B8742-4089-4E77-87D4-4691EA932207" name="GUID-F99B8742-4089-4E77-87D4-4691EA932207"></a>
            
            <h2 id="ADMIN-GUID-F99B8742-4089-4E77-87D4-4691EA932207" class="sect2"><span class="enumeration_chapter">56 </span>Sharded Database Deployment
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>Sharded database deployment includes the prerequisites and instructions for installing the required software components, creating the catalog, roles, and the sharded database, configuring replication for high availability, and creating the schema for the sharded database.</p>
               <p>The following topics contain the concepts and tasks you need to deploy a sharded database:</p>
            </div>
            <div>
               <ul class="ullinks">
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC">Introduction to SDB Deployment</a><br>Oracle Sharding provides the capability to automatically deploy the sharded database (SDB), which includes both the shards and the replicas.
                  </li>
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-9EC92076-7DD0-41ED-9E0C-B96CF074118D">Oracle Sharding Prerequisites</a><br>Before you install any software, review these hardware, network, and operating system requirements for Oracle Sharding.
                  </li>
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-3F3A387E-FAC5-467C-A45E-4A7DFF95B62D">Installing Oracle Database Software</a><br>Install Oracle Database on each system that will host the shard catalog or database shards.
                  </li>
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-E1F8A199-D0D2-4ABA-94EA-E314E83A966F">Installing the Shard Director Software</a><br>Install the global service manager software on each system that you want to host a shard director.
                  </li>
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-9A0F96A7-4D52-4B3A-8538-6DA2AB5A9BFB">Creating the Shard Catalog Database</a><br>Create a non-CDB Oracle Database using DBCA to host the shard catalog.
                  </li>
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-96ABB404-844C-457E-9C10-2D5C352D3928">Setting Up the Oracle Sharding Management and Routing Tier</a><br>The shard catalog, shard directors and shards must be configured to communicate with each other. 
                  </li>
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-A2492CE2-A98C-4F59-9946-889FFD0FEBA9">Creating a System-Managed SDB</a><br></li>
                  <li class="ulchildlink"><a href="sharding-deployment.html#GUID-C43E1E4A-DA8F-4556-9EE7-39097C0276BC">Deploying a Composite SDB</a><br>To deploy a composite SDB you must install the required Oracle Sharding software components, configure the objects for a composite SDB, and create the schema.
                  </li>
               </ul>
            </div>
            
            <div class="sect2"><a id="GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC" name="GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC"></a><h3 id="ADMIN-GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC" class="sect3"><span class="enumeration_section">56.1 </span>Introduction to SDB Deployment
               </h3>
               <div>
                  <p>Oracle Sharding provides the capability to automatically deploy the sharded database (SDB), which includes both the shards and the replicas.</p>
                  <p>The SDB administrator defines the topology (regions, shard hosts, replication technology) and invokes the DEPLOY command with a declarative specification using the GDSCTL command-line interface.</p>
                  <p>At a high level, the deployment steps are:</p>
                  <ol>
                     <li>
                        <p>Set up the components.</p>
                        <div class="infoboxnote" id="GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC__GUID-DAD55745-7216-4261-9C63-368423D25AEC">
                           <p class="notep1">Note:</p>In Oracle Database 12<span class="italic">c</span> Release 1 (12.2.0.1) all shards and shard catalog must be non-CDB databases.
                        </div>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p>Create a non-CDB database that hosts the shard catalog.</p>
                           </li>
                           <li>
                              <p>Install Oracle Database software on the shard nodes.</p>
                           </li>
                           <li>
                              <p>Install shard director (GSM) software on the shard director nodes.</p>
                           </li>
                        </ul>
                        <div class="infoboxnote" id="GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC__GUID-7A30118E-A5AD-4027-B657-D5958A8A6910">
                           <p class="notep1">Note:</p>For production deployments, it is highly recommended that you configure Data Guard for the shard catalog database.
                        </div>
                     </li>
                     <li>
                        <p>Specify the topology layout using the following commands.</p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">CREATE SHARDCATALOG</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ADD GSM</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">START GSM</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ADD CREDENTIAL</code> (if using <code class="codeph">CREATE SHARD</code>)
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">ADD SHARDGROUP</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ADD INVITEDNODE</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">CREATE SHARD</code> (or <code class="codeph">ADD SHARD</code>) for each shard
                              </p>
                           </li>
                        </ul>
                     </li>
                     <li>
                        <p>Run <code class="codeph">DEPLOY</code> and add the global service to access any shard in the SDB.
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">DEPLOY</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">ADD SERVICE</code></p>
                           </li>
                        </ul>
                     </li>
                  </ol>
                  <p>In Oracle Database 12<span class="italic">c</span> Release 1 (12.2.0.1) two replication schemes are supported. The SDB administrator can select either Data Guard or Active Data Guard while specifying the topology.
                  </p>
                  <div class="section">
                     <p class="subhead2">Deployment Methods: CREATE SHARD</p>
                     <p>Oracle Sharding supports two deployment methods. The first method is with the <code class="codeph">CREATE SHARD</code> command, where the creation of shards and the replication configuration are automatically done by the Oracle Sharding management tier.
                     </p>
                     <p>The <code class="codeph">DEPLOY</code> command creates the shards. This is done using the <code class="codeph">DBMS_SCHEDULER</code> package (executed on the shard catalog), which communicates with the Scheduler agents on the remote shard hosts.
                     </p>
                     <p>Agents then invoke DBCA and NETCA to create the shards and the local listeners. After the primary shards are created the corresponding standby shards are built using the RMAN <code class="codeph">DUPLICATE</code> command. Once the primary and standby shards are built, the <code class="codeph">DEPLOY</code> command configures the Data Guard Broker with Fast-Start Failover (FSFO) enabled. The FSFO observers are automatically started on the regional shard director.
                     </p>
                     <div class="infoboxnote" id="GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC__GUID-78696CD0-5EBD-44AA-8BC8-A398302E149A">
                        <p class="notep1">Note:</p>Archivelog and flashback are enabled for all of the shards. This is required for the FSFO observer  to perform standby auto-reinstantiation upon failover.
                     </div>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Deployment Methods: ADD SHARD</p>
                     <p>The second deployment method is with the <code class="codeph">ADD SHARD</code> command. If your database creation standards require that you deploy the SDB using your own pre-created databases, the <code class="codeph">ADD SHARD</code> deployment method supports this requirement by simply adding your prebuilt database shards.
                     </p>
                     <p>When the <code class="codeph">ADD SHARD</code> command is used for deployment, the <code class="codeph">DEPLOY</code> command handles the configuration of the Data Guard, Broker, and Fast-start Failover. It also handles the scenario where you have pre-configured Data Guard for the shard that is being added.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-9EC92076-7DD0-41ED-9E0C-B96CF074118D" name="GUID-9EC92076-7DD0-41ED-9E0C-B96CF074118D"></a><h3 id="ADMIN-GUID-9EC92076-7DD0-41ED-9E0C-B96CF074118D" class="sect3"><span class="enumeration_section">56.2 </span>Oracle Sharding Prerequisites
               </h3>
               <div>
                  <p>Before you install any software, review these hardware, network, and operating system requirements for Oracle Sharding.</p>
                  <div class="section">
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Hardware and operating system requirements for the shards are the same as that on which Oracle Database 12<span class="italic">c</span> Release 2 is supported. See your Oracle Database installation documentation for these requirements.
                           </p>
                        </li>
                        <li>
                           <p>Hardware, software, and operating system requirements for the shard catalog and shard directors are the same as for the Global Data Services catalog and global service manager. See <a href="../gsmug/global-data-services-config.html#GSMUG-GUID-B7010949-4EAE-4AB1-A136-D5A4CD2AE688"><span><cite>Oracle Database Global Data Services Concepts and Administration Guide</cite></span></a> for these requirements.
                           </p>
                        </li>
                        <li>
                           <p>Network requirements are Low Latency GigE</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-3F3A387E-FAC5-467C-A45E-4A7DFF95B62D" name="GUID-3F3A387E-FAC5-467C-A45E-4A7DFF95B62D"></a><h3 id="ADMIN-GUID-3F3A387E-FAC5-467C-A45E-4A7DFF95B62D" class="sect3"><span class="enumeration_section">56.3 </span>Installing Oracle Database Software
               </h3>
               <div>
                  <p>Install Oracle Database on each system that will host the shard catalog or database shards.</p>
                  <div class="p">
                     <p>Before installing Oracle Database, create an operating system user on all of the systems where you will be hosting the sharded database, shard catalog, and shard directors, and assign them to the DBA group. Allow the user to run <code class="codeph">su</code>, and make note of the credentials so that you can use them in later procedures.
                     </p>
                     <p>See <a href="../ladbi/configuring-users-groups-and-environments-for-oracle-grid-infrastructure-and-oracle-database.html#LADBI-GUID-B65E6113-D056-4DD9-940F-DFF493E413D5"><span><cite>Oracle Database Installation Guide for Linux</cite></span></a>, or your platform’s installation guide, for information about configuring operating system users.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <ol>
                     <li><span>Download the Oracle Database installer on all of the systems that will host the shard catalog or the database shards.</span></li>
                     <li><span>Install Oracle Database on all of the systems where you intend to host the shard catalog and sharded database.</span><ol type="a">
                           <li class="substepexpand"><span>Run the installer on the first system.</span><div><pre class="pre codeblock"><code>$ cd /u01/stage/database
$ ./runInstaller</code></pre><p>As you step through the Oracle Database installation, be sure to select the following options on the noted screens:</p>
                                 <ul style="list-style-type: disc;">
                                    <li>
                                       <p>On the Installation Option page, select <span class="bold">Install database software only</span>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>On the Grid Installation Options page, select <span class="bold">Single instance database installation</span>. Oracle RAC and Oracle RAC One Node are not supported in this release.
                                       </p>
                                    </li>
                                    <li>
                                       <p>On the Database Edition page, select <span class="bold">Enterprise Edition</span>.
                                       </p>
                                    </li>
                                    <li>
                                       <p>On the Installation Location page, use the same<span class="bold"> Oracle base</span> and<span class="bold"> Software location</span> values that you used when creating the environment scripts in the steps above.
                                       </p>
                                    </li>
                                    <li>
                                       <p>On the Create Inventory page, accept the defaults.</p>
                                    </li>
                                    <li>
                                       <p>On the Operating System Groups page, accept the defaults or make changes as appropriate for your environment.</p>
                                    </li>
                                    <li>
                                       <p>On the Summary page, you can click <span class="bold">Save Response File</span> to create a file for silent installation of the Oracle Database software on the remaining hosts.
                                       </p>
                                    </li>
                                    <li>
                                       <p>During installation, execute the <code class="codeph">orainstRoot.sh</code> and <code class="codeph">root.sh</code> scripts as <code class="codeph">root</code> in a separate terminal when prompted.
                                       </p>
                                    </li>
                                 </ul>
                              </div>
                           </li>
                           <li class="substepexpand"><span>Optionally, using the response file you created in the first installation, run a silent install on each of the remaining hosts.</span><div>
                                 <p>Note that, after performing a silent install using a response file, when you run the database <code class="codeph">root.sh</code> script its execution might not prompt you interactively for any values and uses only default values (for example, for the local user <code class="codeph">bin</code> directory). If any non-default values are desired, specify just the <code class="codeph">-responseFile</code> location when invoking the Installer and omit the <code class="codeph">-silent</code> option. Click through the Installer screens, accepting the response file values, and then run the root script(s) when prompted. During root script execution, any user prompts are presented to you and non-default values can be entered.
                                 </p>
                              </div>
                           </li>
                        </ol>
                     </li>
                  </ol>
                  <div class="section">
                     <div class="infoboxnotealso" id="GUID-3F3A387E-FAC5-467C-A45E-4A7DFF95B62D__GUID-ECA079BF-D17D-4C39-AEE7-5A6FD9AC57D5">
                        <p class="notep1">See Also:</p>
                        <p><a href="../ladbi/installing-and-configuring-oracle-database-using-response-files.html#LADBI-GUID-D53355E9-E901-4224-9A2A-B882070EDDF7"><span><cite>Oracle Database Installation Guide for Linux</cite></span></a> for more information about using the response file for silent installation of Oracle Database
                        </p>
                     </div>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-E1F8A199-D0D2-4ABA-94EA-E314E83A966F" name="GUID-E1F8A199-D0D2-4ABA-94EA-E314E83A966F"></a><h3 id="ADMIN-GUID-E1F8A199-D0D2-4ABA-94EA-E314E83A966F" class="sect3"><span class="enumeration_section">56.4 </span>Installing the Shard Director Software
               </h3>
               <div>
                  <p>Install the global service manager software on each system that you want to host a shard director.</p>
                  <ol>
                     <li class="stepexpand"><span>Download the Oracle Global Service Manager installer on all of the systems that will host the shard directors.</span></li>
                     <li class="stepexpand"><span>See <a href="../gsmug/global-data-services-config.html#GSMUG-GUID-04D33448-2CB4-40C7-9DA0-1CFC6EC5E101"><span><cite>Oracle Database Global Data Services Concepts and Administration Guide</cite></span></a> for information about installing a global service manager.</span></li>
                     <li class="stepexpand"><span>Optionally, using the response file you created in the first installation, run a silent install on each of the remaining shard director hosts.</span><div>
                           <p>Note that, after performing a silent install using a response file, when you run the database <code class="codeph">root.sh</code> script its execution might not prompt you interactively for any values and uses only default values (for example, for the local user <code class="codeph">bin</code> directory). If any non-default values are desired, specify just the <code class="codeph">-responseFile</code> location when invoking the Installer and omit the <code class="codeph">-silent</code> option. Click through the Installer screens, accepting the response file values, and then run the root script(s) when prompted. During root script execution, any user prompts are presented to you and non-default values can be entered.
                           </p>
                        </div>
                     </li>
                  </ol>
               </div>
            </div>
            <div class="sect2"><a id="GUID-9A0F96A7-4D52-4B3A-8538-6DA2AB5A9BFB" name="GUID-9A0F96A7-4D52-4B3A-8538-6DA2AB5A9BFB"></a><h3 id="ADMIN-GUID-9A0F96A7-4D52-4B3A-8538-6DA2AB5A9BFB" class="sect3"><span class="enumeration_section">56.5 </span>Creating the Shard Catalog Database
               </h3>
               <div>
                  <p>Create a non-CDB Oracle Database using DBCA to host the shard catalog.</p>
                  <ol>
                     <li class="stepexpand"><span>Connect to the host where you will host the shard catalog, and verify that the expected environment variables are set to the correct values.</span><div><pre class="pre codeblock"><code>$ env |grep ORA
ORACLE_BASE=/u01/app/oracle
ORACLE_HOME=/u01/app/oracle/product/12.2.0/dbhome_1</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Create the oradata and fast_recovery_area directories.</span><div><pre class="pre codeblock"><code>$ mkdir /u01/app/oracle/oradata
$ mkdir /u01/app/oracle/fast_recovery_area
</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Run DBCA to create the shard catalog database.</span><div><pre class="pre codeblock"><code>$ dbca</code></pre></div>
                        <div>The Database Configuration Assistant opens.</div>
                     </li>
                     <li class="stepexpand"><span>On the Database Operation page, select <span class="bold">Create a database</span>, and click <span class="bold">Next</span>.</span></li>
                     <li class="stepexpand"><span>On the Creation Mode page, select <span class="bold">Advanced configuration</span>, and click <span class="bold">Next</span>.</span></li>
                     <li class="stepexpand"><span>On the Deployment Type page, select the <span class="bold">Oracle Single Instance database</span> database type, select the <span class="bold">General Purpose or Transaction Processing</span> template, and click <span class="bold">Next</span>.</span></li>
                     <li class="stepexpand"><span>On the Database Identification page, enter the <span class="bold">Global Database name</span> and the shard catalog <span class="bold">SID</span> that you configured in the shard catalog host environment script, uncheck the <span class="bold">Create as Container Database</span> option, and click <span class="bold">Next</span>.</span><div>
                           <div class="infoboxnote" id="GUID-9A0F96A7-4D52-4B3A-8538-6DA2AB5A9BFB__GUID-9EA4A982-E1D0-40CF-B06E-296A9AFFE3E0">
                              <p class="notep1">Important:</p>Container databases are not supported in this release of Oracle Sharding. Be sure to uncheck this option before you continue.
                           </div>
                        </div>
                     </li>
                     <li class="stepexpand"><span>On the Storage Option page, select the <span class="bold">Use following for the database storage attributes</span> option, select <span class="bold">File System</span>, select the <span class="bold">Use Oracle-Managed Files (OMF)</span> option, and click <span class="bold">Next</span>.</span></li>
                     <li class="stepexpand"><span>On the Select Fast Recovery Option page, select <span class="bold">Specify Fast Recovery Area</span>, select <span class="bold">Enable archiving</span>, and click <span class="bold">Next</span>.</span></li>
                     <li class="stepexpand"><span>On the Specify Network Configuration Details page, select <span class="bold">Create a new listener</span>, set the listener name and port number, and click <span class="bold">Next</span>.</span><div>Make note of the listener name so that you can connect to the database later.</div>
                     </li>
                     <li class="stepexpand"><span>Skip the Data Vault Option page.</span></li>
                     <li class="stepexpand"><span>On the Configuration Options page <span class="bold">Memory</span> tab, select <span class="bold">Use Automatic Shared Memory Management</span>.</span></li>
                     <li class="stepexpand"><span>On the Configuration Options page <span class="bold">Character sets</span> tab, select <span class="bold">Use Unicode (AL32UTF8)</span>, and click <span class="bold">Next</span></span></li>
                     <li class="stepexpand"><span>On the Management Option page, uncheck the <span class="bold">Configure Enterprise Manager (EM) database express</span> option, and click <span class="bold">Next</span>.</span></li>
                     <li class="stepexpand"><span>On the User Credentials page, select the appropriate option for your business needs, enter the passwords, and click <span class="bold">Next</span>.</span><div>
                           <p>Make a note of the passwords you entered because you will need them later.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>On the Creation Option page, select <span class="bold">Create database</span>, and click <span class="bold">Next</span>.</span></li>
                     <li class="stepexpand"><span>On the Summary page, click <span class="bold">Finish</span>.</span></li>
                     <li class="stepexpand"><span>After the database has been created, make a note of the Global Database Name, SID, and spfile values.</span></li>
                     <li class="stepexpand"><span>If you plan to use Oracle Data Guard to protect the shard catalog database, click <span class="bold">Password Management</span>, unlock the SYSDG account, and make a note of the password you enter for this account.</span></li>
                     <li class="stepexpand"><span>Click <span class="bold">Close</span> to exit DBCA.</span></li>
                  </ol>
               </div>
            </div>
            <div class="sect2"><a id="GUID-96ABB404-844C-457E-9C10-2D5C352D3928" name="GUID-96ABB404-844C-457E-9C10-2D5C352D3928"></a><h3 id="ADMIN-GUID-96ABB404-844C-457E-9C10-2D5C352D3928" class="sect3"><span class="enumeration_section">56.6 </span>Setting Up the Oracle Sharding Management and Routing Tier
               </h3>
               <div>
                  <p>The shard catalog, shard directors and shards must be configured to communicate with each other. </p>
                  <ol>
                     <li class="stepexpand"><span>On the shard catalog host, verify that the expected environment values are set to the correct values.</span><div><pre class="pre codeblock"><code>$ env |grep ORA
ORACLE_SID=shardcat
ORACLE_BASE=/u01/app/oracle
ORACLE_HOME=/u01/app/oracle/product/12.2.0/dbhome_1</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>If the shard catalog listener is not already started, start the shard catalog listener.</span><div><pre class="pre codeblock"><code>$ lsnrctl start</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Verify that <code class="codeph">DB_CREATE_FILE_DEST</code> parameter is set on the shard catalog database.</span><div>
                           <p>If the parameter is not set, then set it as shown in the following example. Note that <code class="codeph">open_links</code> and <code class="codeph">open_links_per_instance</code> are set to 16 for the purposes of the Oracle Sharding demo application.
                           </p><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; alter system set db_create_file_dest='/u01/app/oracle/oradata' scope=both;
SQL&gt; alter system set open_links=16 scope=spfile;
SQL&gt; alter system set open_links_per_instance=16 scope=spfile;
</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Shut down and restart the shard catalog database.</span><div><pre class="pre codeblock"><code>SQL&gt; shutdown immediate
Datablase closed.
Database dismounted.

SQL&gt; startup
ORACLE instance started.

Total System Global Area 4798283776 bytes
Fixed Size                  4430760 bytes
Variable Size            1006634072 bytes
Database Buffers         3774873600 bytes
Redo Buffers               12345344 bytes
Database mounted.
Database opened.</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Grant roles and privileges on the shard catalog database.</span><div><pre class="pre codeblock"><code>SQL&gt; set echo on
SQL&gt; set termout on
SQL&gt; spool setup_grants_privs.lst
</code></pre></div>
                        <ol type="a">
                           <li class="substepexpand"><span>Unlock and set the password for the GSMCATUSER schema.</span><div>
                                 <p>This schema is used by the shard director when connecting to the shard catalog database.</p><pre class="pre codeblock"><code>SQL&gt; alter user gsmcatuser account unlock;
SQL&gt; alter user gsmcatuser identified by <span class="variable">gsmcatuser_password</span>;</code></pre></div>
                           </li>
                           <li class="substepexpand"><span>Create the administrator schema and grant privileges to it. </span><div>
                                 <p>The mysdbadmin account is an account in the shard catalog database which stores information on the sharding environment. The mysdbadmin account is the database administrator schema for making administrative changes to the sharded database environment. GDSCTL connects through this user to the database when GDSCTL commands are run, and the mysdbadmin user makes the necessary changes in the database.</p><pre class="pre codeblock"><code>SQL&gt; create user mysdbadmin identified by <span class="variable">mysdbadmin_password</span>;
SQL&gt; grant connect, create session, gsmadmin_role to mysdbadmin;
SQL&gt; grant inherit privileges on user SYS to GSMADMIN_INTERNAL;
SQL&gt; spool off</code></pre></div>
                           </li>
                        </ol>
                     </li>
                     <li class="stepexpand"><span>Connect to a shard director host and start GDSCTL.</span><div>
                           <p>The commands in the following steps are executed from a shard director host because the GDSCTL command line interface is installed there. </p>
                           <p>The following example includes a sanity check that environment variables have been set properly.</p><pre class="pre codeblock"><code>$ env |grep ORA
ORACLE_BASE=/u01/app/oracle
ORACLE_HOME=/u01/app/oracle/product/12.2.0/gsmhome_1

$ gdsctl
</code></pre></div>
                     </li>
                     <li class="stepexpand"><span>Create the shard catalog and configure the remote scheduler agent on the shard catalog.</span><div>
                           <p>In this example, the sharded database is given the name cust_sdb, and two regions are created: region1 and region2. The regions are used as local availability domains for failover of the shards from the primary to physical standby. The regions are not meant to represent geographical regions in this example. </p><pre class="pre codeblock"><code>GDSCTL&gt; create shardcatalog -database <span class="variable">shard_catalog_host</span>:1521:<span class="variable">shard_catalog_name</span> -chunks 12 -user mysdbadmin/<span class="variable">mysdbadmin_password</span>
 -sdb cust_sdb -region region1, region2  -agent_port <span class="variable">port_num</span> -agent_password <span class="variable">rsa_password</span></code></pre></div>
                     </li>
                     <li class="stepexpand"><span>While you are connected to the shard director host, create and start the shard director.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; add gsm -gsm sharddirector1 -listener <span class="variable">listener_port</span> -pwd <span class="variable">gsmcatuser_password</span>
 -catalog <span class="variable">shard_catalog_host</span>:1521:shardcat -region region1

GDSCTL&gt; start gsm -gsm sharddirector1</code></pre><p>Repeat steps 6 and 8 on each shard director host. Replace the shard director name and region name with appropriate values for each host.</p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Using GDSCTL, set the operating system credentials.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; add credential -credential <span class="variable">credential_name</span> -osaccount <span class="variable">os_account_name</span> -ospassword <span class="variable">os_password</span>

GDSCTL&gt; exit</code></pre><p>These credentials are the operating system user name and password on the shard hosts (not the catalog host), and the credentials are used by the remote scheduler agent to run jobs on the hosts to set up the shards using DBCA, NETCA, and the like.</p>
                           <p>Repeat this step if a different operating system credential will be used for each host. </p>
                        </div>
                     </li>
                     <li class="stepexpand"><span>Connect to each of the shard hosts, register remote scheduler agents on them, and create directories for oradata and fast_recovery_area on them.</span><div>
                           <div class="infoboxnote" id="GUID-96ABB404-844C-457E-9C10-2D5C352D3928__GUID-5D285EB7-1EA7-4DDB-B312-8454C5159809">
                              <p class="notep1">Note:</p>This step is only required if you are using the <code class="codeph">CREATE SHARD</code> method described in <a href="sharding-deployment.html#GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC" title="Oracle Sharding provides the capability to automatically deploy the sharded database (SDB), which includes both the shards and the replicas.">Introduction to SDB Deployment</a>. If you are using the <code class="codeph">ADD SHARD</code> method you can skip this step.
                           </div>
                           <p>Execute the following statements on each of the machines that will host a shard.</p>
                           <p>Note that the <span class="variable">os_account_name</span> is the account used for Oracle software installation, <span class="variable">shard_host</span> is the host name or IP address of the machine hosting the shard, the <span class="variable">shard_catalog_host</span> is the host name or IP address of the shard catalog host, and <span class="variable">port_num</span> is the remote scheduler agent port number as specified in the <code class="codeph">-agent_port</code> parameter for <code class="codeph">create shardcatalog</code> in step 7 above. The remote scheduler agent prompts you for the agent registration password specified in the <code class="codeph">-agent_password</code> parameter of <code class="codeph">create shardcatalog</code> in step 7 above.
                           </p><pre class="pre codeblock"><code>$ ssh <span class="variable">os_account_name</span>@<span class="variable">shard_host</span>
passwd: <span class="variable">os_password</span>

$ schagent -start
$ schagent -status
$ schagent -registerdatabase <span class="variable">shard_catalog_host</span> <span class="variable">port_num</span>

$ mkdir /u01/app/oracle/oradata
$ mkdir /u01/app/oracle/fast_recovery_area</code></pre></div>
                     </li>
                  </ol>
               </div>
            </div>
            <div class="sect2"><a id="GUID-A2492CE2-A98C-4F59-9946-889FFD0FEBA9" name="GUID-A2492CE2-A98C-4F59-9946-889FFD0FEBA9"></a><h3 id="ADMIN-GUID-A2492CE2-A98C-4F59-9946-889FFD0FEBA9" class="sect3"><span class="enumeration_section">56.7 </span>Creating a System-Managed SDB
               </h3>
               <div>
                  <p></p>
                  <p>The following topics describe the tasks for creating a system-managed SDB.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sharding-deployment.html#GUID-4E77F1B8-F665-40C4-B4AC-B321C7302AA9">Deploying a System-Managed SDB</a><br>To deploy a system-managed SDB you create shardgroups and shards, create and configure the databases to be used as shards, execute the <code>DEPLOY</code> command, and create role-based global services.
                     </li>
                     <li class="ulchildlink"><a href="sharding-deployment.html#GUID-61B495D3-4482-47E2-937E-B7E03286F565">Creating a Schema for a System-Managed SDB</a><br>Create the schema user, tablespace set, sharded tables, and duplicated tables for the SDB. Verify that the DDLs are propagated to all of the shards, and, while connected to the shards, verify the automatic Data Guard Broker configuration with Fast-Start Failover.
                     </li>
                     <li class="ulchildlink"><a href="sharding-deployment.html#GUID-A3433C97-90F8-4CBF-ADA8-2AE2145612DB">System-Managed SDB Demo Application</a><br>The system-managed sharded database (SDB) demo application simulates the workload of an online retail store. Use it to validate the setup of any system-managed (automatic sharding) SDB configuration. The demo application also provides a practical example of sharding concepts for administrators and developers new to database sharding.
                     </li>
                  </ul>
               </div>
               
               <div class="sect3"><a id="GUID-4E77F1B8-F665-40C4-B4AC-B321C7302AA9" name="GUID-4E77F1B8-F665-40C4-B4AC-B321C7302AA9"></a><h4 id="ADMIN-GUID-4E77F1B8-F665-40C4-B4AC-B321C7302AA9" class="sect4"><span class="enumeration_section">56.7.1 </span>Deploying a System-Managed SDB
                  </h4>
                  <div>
                     <p>To deploy a system-managed SDB you create shardgroups and shards, create and configure the databases to be used as shards, execute the <code>DEPLOY</code> command, and create role-based global services.
                     </p>
                     <div class="section">
                        <p>System-managed sharding does not require the user to map data to shards. Data is automatically distributed across shards using partitioning by consistent hash. The partitioning algorithm evenly and randomly distributes data across shards. For more conceptual information about the system-managed SDB, see <a href="sharding-methods.html#GUID-37F20817-EFD5-400B-A082-41171C0B6D1C" title="System-managed sharding is a sharding method which does not require the user to specify mapping of data to shards. Data is automatically distributed across shards using partitioning by consistent hash. The partitioning algorithm evenly and randomly distributes data across shards.">System-Managed Sharding</a>.
                        </p>
                     </div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>If you are using the <code class="codeph">ADD SHARD</code> method described in <a href="sharding-deployment.html#GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC" title="Oracle Sharding provides the capability to automatically deploy the sharded database (SDB), which includes both the shards and the replicas.">Introduction to SDB Deployment</a> you must first create the databases to be used as shards on their respective hosts.</span><div>
                              <p>The shard databases must have the following characteristics:</p>
                              <ul style="list-style-type: disc;">
                                 <li>
                                    <p>They must not be container databases (CDBs)</p>
                                 </li>
                                 <li>
                                    <p>They must have an associated TNS Listener on port 1521 on each host</p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">GSMUSER</code> account must be unlocked with a known password
                                    </p>
                                 </li>
                                 <li>
                                    <p>The primary and standby databases must be configured as such</p>
                                 </li>
                                 <li>
                                    <p>Redo apply should be set up between the corresponding primary and standby databases</p>
                                 </li>
                                 <li>
                                    <p>Flashback and force logging should be enabled</p>
                                 </li>
                                 <li>
                                    <p>The <code class="codeph">compatible</code> parameter must be set to at least 12.2.0
                                    </p>
                                 </li>
                                 <li>
                                    <p>A server parameter file (SPFILE) must be in use</p>
                                 </li>
                                 <li>
                                    <p>A <code class="codeph">DATA_PUMP_DIR</code> directory object must be created in each database and must point to a valid directory
                                    </p>
                                 </li>
                              </ul>
                              <p>You must then validate that a database is correctly set up for sharding. Execute the following against each database before adding it to the configuration.</p><pre class="pre codeblock"><code>SQL&gt; set serveroutput on
SQL&gt; execute DBMS_GSM_FIX.validateShard</code></pre><p>Screen output will include INFO, WARNING, and ERROR information that needs to be analyzed for any issues. All WARNING and ERROR messages must be resolved.  Re-run <code class="codeph">validateShard()</code> after making changes to confirm the configuration.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Connect to the shard director host.</span><div><pre class="pre codeblock"><code>$ ssh <span class="variable">os_user</span>@<span class="variable">shard_director1_host</span>
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Set the global service manager for the current session, and specify the credentials to administer it.</span><div><pre class="pre codeblock"><code>$ gdsctl
GDSCTL&gt; set gsm -gsm sharddirector1
GDSCTL&gt; connect mysdbadmin/<span class="variable">mysdbadmin_password</span></code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add a shardgroup for the primary shards.</span><div>
                              <p>In this example the shardgroup is named primary_shardgroup. You can choose your own name.</p><pre class="pre codeblock"><code>GDSCTL&gt; add shardgroup -shardgroup primary_shardgroup -deploy_as primary -region region1</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add a shardgroup for the Active Data Guard standby shards.</span><div>
                              <p>In this example the shardgroup is named standby_shardgroup. You can choose your own name.</p><pre class="pre codeblock"><code>GDSCTL&gt; add shardgroup -shardgroup standby_shardgroup -deploy_as active_standby -region region2 </code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add each shard’s host address to the valid node checking for registration (VNCR) list in the catalog, then create the shard in either the primary or standby shardgroup, as shown in the following example.</span><div>
                              <div class="infoboxnote" id="GUID-4E77F1B8-F665-40C4-B4AC-B321C7302AA9__THEVALIDNODECHECKINGFORREGISTRATION-3F858F5D">
                                 <p class="notep1">Note:</p>
                                 <p>The valid node checking for registration (VNCR) feature provides the ability to configure and dynamically update a set of IP addresses, host names, or subnets from which registration requests are allowed by the shard directors. Database instance registration with a shard director succeeds only when the request originates from a valid node. By default, the shard management tier (based on Oracle Global Data Services framework) automatically adds a VNCR entry for the host on which a remote database is running each time <code class="codeph">create shard</code> or <code class="codeph">add shard</code> is executed. The automation (called auto-VNCR) finds the public IP address of the target host, and automatically adds a VNCR entry for that IP address. If the host has multiple public IP addresses, then the address on which the database registers may not be the same as the address which was added using auto-VNCR and , as a result, registration many be rejected. If the target database host has multiple public IP addresses, it is advisable that you configure VNCR manually for this host using the <code class="codeph">add invitednode</code> or <code class="codeph">add invitedsubnet</code> commands in GDSCTL.
                                 </p>
                                 <p>If there are&nbsp;multiple net-cards on the target host (<code class="codeph">/sbin/ifconfig</code> returns more than one public interface), use <code class="codeph">add invitednode</code> to be safe (after finding out which interface will be used to route packets).
                                 </p>
                                 <p>If there is any doubt about registration, then use <code class="codeph">config vncr</code> and use <code class="codeph">add invitednode</code> as necessary. There is no harm in doing this, because if the node is added already, auto-VNCR ignores it, and if you try to add it after auto-VNCR already added it, you will get a warning stating that it already exists.
                                 </p>
                              </div>
                              <p>The following example shows how to create four shards using the <code class="codeph">CREATE SHARD</code> command, two of which are in the primary shardgroup and two in the standby shardgroup. The <span class="variable">credential_name</span> is the operating system credential you created on each host.
                              </p>
                              <p>While creating the shards, you can also set the SYS password in the <code class="codeph">create shard</code> using <code class="codeph">-sys_password</code> as shown in the following example. This sets the SYS password after the shards are created when running <code class="codeph">DEPLOY</code>.
                              </p><pre class="pre codeblock"><code>GDSCTL&gt; add invitednode <span class="variable">shard_host_1</span> 
GDSCTL&gt; create shard -shardgroup primary_shardgroup -destination <span class="variable">shard_host_1</span> -credential <span class="variable">credential_name</span> -sys_password <span class="variable">sys_password</span>

GDSCTL&gt; add invitednode <span class="variable">shard_host_2</span>
GDSCTL&gt; create shard -shardgroup standby_shardgroup -destination <span class="variable">shard_host_2</span> -credential <span class="variable">credential_name</span> -sys_password <span class="variable">sys_password</span>
GDSCTL&gt; add invitednode <span class="variable">shard_host_3</span> 
GDSCTL&gt; create shard -shardgroup primary_shardgroup -destination <span class="variable">shard_host_3</span> -credential <span class="variable">credential_name</span> -sys_password <span class="variable">sys_password</span>
GDSCTL&gt; add invitednode <span class="variable">shard_host_4</span>
GDSCTL&gt; create shard -shardgroup standby_shardgroup -destination <span class="variable">shard_host_4</span> -credential <span class="variable">credential_name</span> -sys_password <span class="variable">sys_password</span></code></pre><p>If you are using the <code class="codeph">ADD SHARD</code> method described in <a href="sharding-deployment.html#GUID-059FD35C-C1C2-4B14-9A76-B3632A6080DC" title="Oracle Sharding provides the capability to automatically deploy the sharded database (SDB), which includes both the shards and the replicas.">Introduction to SDB Deployment</a>, use the following command instead of the <code class="codeph">CREATE SHARD</code> commands in the example above.
                              </p><pre class="pre codeblock"><code>GDSCTL&gt; add shard &#x2013;shardgroup shgrp1 &#x2013;connect <span class="variable">shard_host</span>:1521/<span class="variable">shard_database_name</span> &#x2013;pwd <span class="variable">GSMUSER_password</span></code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Check the configuration from a shard director.</span><div>
                              <p>Note that the shard names, sh1, sh2, sh3, and sh4, are system generated shard names when the <code class="codeph">CREATE SHARD</code> method is used.
                              </p><pre class="pre codeblock"><code>GDSCTL&gt; config
Regions
-----------------------
region1
region2

GSMs
-----------------------
sharddirector1
sharddirector2

Sharded Database
-----------------------
cust_sdb

Databases
-----------------------
sh1
sh2
sh3
sh4

Shard Groups
-----------------------
primary_shardgroup
standby_shardgroup

Shard spaces
-----------------------
shardspaceora

Services
-----------------------

GDSCTL pending requests
-----------------------
Command          Object          Status
-------          ------          ------

Global properties
-----------------------
Name: oradbcloud
Master GSM: sharddirector1
DDL sequence #: 0

GDSCTL&gt; config shardspace
SHARDSPACE       Chunks
----------       ------
shardspaceora    12

GDSCTL&gt; config shardgroup
Shard Group               Chunks    Region    SHARDSPACE
-----------               ------    ------    ----------
primary_shardgroup        12        region1   shardspaceora
standby_shardgroup        12        region2   shardspaceora

GDSCTL&gt; config vncr
Name    Group ID 
----    --------
shard_host_1 
shard_host_2
shard_host_3
shard_host_4
shard_catalog_host_IP

GDSCTL&gt; config shard
Name     Shard Group          Status    State    Region    Availability
----     -----------          ------    -----    ------    ------------
sh1      primary_shardgroup   U         none     region1   -
sh2      standby_shardgroup   U         none     region2   -
sh3      primary_shardgroup   U         none     region1   -
sh4      standby_shardgroup   U         none     region2   -</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Run the <code>DEPLOY</code> command to create the shards and the replicas.</span><div>
                              <p>The <code>DEPLOY</code> command takes some time to run, approximately 15 to 30 minutes.
                              </p><pre class="pre codeblock"><code>GDSCTL&gt; deploy</code></pre><p>When the <code class="codeph">CREATE SHARD</code> method is used to create the shards, the DEPLOY command creates the primary and standby shards using DBCA. Archivelog and flashback, which is required for the Fast-Start Failover observers to perform standby reinstantiation, are enabled for all of the shards.
                              </p>
                              <p>Once the primary and standby shards are built, the <code>DEPLOY</code> command configures the Data Guard Broker with Fast-Start Failover enabled. The Fast-Start Failover observers are automatically started on the standby group’s shard director (sharddirector2 in this example).
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Verify that all of the shards are deployed.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; config shard
Name    Shard Group           Status    State        Region    Availability
----    -----------           ------    -----        ------    ------------
sh1      primary_shardgroup   Ok        Deployed     region1   ONLINE
sh2      standby_shardgroup   Ok        Deployed     region2   READ_ONLY
sh3      primary_shardgroup   Ok        Deployed     region1   ONLINE
sh4      standby_shardgroup   Ok        Deployed     region2   READ_ONLY</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that all of the shards are registered.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; databases
Database: "sh1" Registered: Y State: Ok ONS: N. Role: PRIMARY
Instances: 1 Region: region1
   Registered instances: 
     cust_sdb%1
Database: "sh2" Registered: Y State: Ok ONS: N. Role: PH_STNDBY
Instances: 1 Region: region2
   Registered instances: 
     cust_sdb%11
Database: "sh3" Registered: Y State: Ok ONS: N. Role: PRIMARY
Instances: 1 Region: region1
   Registered instances: 
     cust_sdb%21
Database: "sh4" Registered: Y State: Ok ONS: N. Role: PH_STNDBY
Instances: 1 Region: region2
   Registered instances: 
     cust_sdb%31</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Check the configuration of a shard.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; config shard -shard sh1
Name: sh1
Shard Group: primary_shardgroup
Status: Ok
State: Deployed
Region: region1
Connection string: <span class="variable">shard_host_1</span>:1521/<span class="variable">sh1</span>:dedicated
SCAN address:
ONS remote port: 0
Disk Threshold, ms: 20
CPU Threshold, %: 75
Version: 12.2.0.1
Last Failed DDL: 
DDL Error: ---
Failed DDL id:
Availability: ONLINE

Supported services
-----------------------
Name                Preferred Status
----                --------- ------</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add a global service that runs on all of the primary shards. </span><div>
                              <p>The oltp_rw_srvc global service is a global data service that a client can use to connect to the sharded database. The oltp_rw_srvc service runs the OLTP transactions on the primary shards. Likewise, the oltp_ro_srvc global service is created to run read-only workload on the standby shards.</p><pre class="pre codeblock"><code>GDSCTL&gt; add service -service oltp_rw_srvc -role primary&nbsp;

GDSCTL&gt; config service 

Name          Network name                      Pool         Started Preferred all
----          ------------                      ----         ------- -------------
oltp_rw_srvc  oltp_rw_srvc.cust_sdb.oracdbcloud cust_sdb     No      Yes</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Start the oltp_rw_srvc global service.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; start service -service oltp_rw_srvc

GDSCTL&gt; status service
Service "oltp_rw_srvc.cust_sdb.oradbcloud" has 2 instance(s). Affinity: ANYWHERE
   Instance "cust_sdb%1", name: "sh1", db: "sh1", region: "region1", status: ready.
   Instance "cust_sdb%21", name: "sh3", db: "sh3", region: "region1", status: ready.</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add a global service for the read-only workload to run on the standby shards.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; add service -service oltp_ro_srvc -role physical_standby

GDSCTL&gt; config service 

Name          Network name                      Pool         Started Preferred all
----          ------------                      ----         ------- -------------
oltp_rw_srvc  oltp_rw_srvc.cust_sdb.oracdbcloud cust_sdb     Yes     Yes
oltp_ro_srvc  oltp_ro_srvc.cust_sdb.oracdbcloud cust_sdb     No      Yes
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Start the read-only service, and verify the status of the global services.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; start service -service oltp_ro_srvc

GDSCTL&gt; status service
Service "oltp_<span class="bold">ro</span>_srvc.cust_sdb.oradbcloud" has 2 instance(s). Affinity: ANYWHERE
   Instance "cust_sdb%11", name: "sh2", db: "sh2", region: "region2", status: ready.
   Instance "cust_sdb%31", name: "sh4", db: "sh4", region: "region2", status: ready.
Service "oltp_<span class="bold">rw</span>_srvc.cust_sdb.oradbcloud" has 2 instance(s). Affinity: ANYWHERE
   Instance "cust_sdb%1", name: "sh1", db: "sh1", region: "region1", status: ready.
   Instance "cust_sdb%21", name: "sh3", db: "sh3", region: "region1", status: ready.</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-4E77F1B8-F665-40C4-B4AC-B321C7302AA9__GUID-0A88E5FE-1FBD-4DD8-BEDE-DB97D221C345">
                           <p class="notep1">See Also:</p>
                           <p><a href="sharding-deployment.html#GUID-61B495D3-4482-47E2-937E-B7E03286F565" title="Create the schema user, tablespace set, sharded tables, and duplicated tables for the SDB. Verify that the DDLs are propagated to all of the shards, and, while connected to the shards, verify the automatic Data Guard Broker configuration with Fast-Start Failover.">Creating a Schema for a System-Managed SDB</a></p>
                           <p><a href="../gsmug/gdsctl-sharding-env.html#GSMUG-GUID-3285C437-78F8-4339-AAAB-33DBB7A9D400"><span><cite>Oracle Database Global Data Services Concepts and Administration Guide</cite></span></a> for more information about GDSCTL command usage
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-61B495D3-4482-47E2-937E-B7E03286F565" name="GUID-61B495D3-4482-47E2-937E-B7E03286F565"></a><h4 id="ADMIN-GUID-61B495D3-4482-47E2-937E-B7E03286F565" class="sect4"><span class="enumeration_section">56.7.2 </span>Creating a Schema for a System-Managed SDB
                  </h4>
                  <div>
                     <p>Create the schema user, tablespace set, sharded tables, and duplicated tables for the SDB. Verify that the DDLs are propagated to all of the shards, and, while connected to the shards, verify the automatic Data Guard Broker configuration with Fast-Start Failover.</p>
                     <ol>
                        <li class="stepexpand"><span>Connect to the shard catalog database, create the application schema user, and grant privileges and roles to the user.</span><div>
                              <p>In this example, the application schema user is called app_schema.</p><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; alter session enable shard ddl;
SQL&gt; create user app_schema identified by <span class="variable">app_schema_password</span>;
SQL&gt; grant all privileges to app_schema;
SQL&gt; grant gsmadmin_role to app_schema;
SQL&gt; grant select_catalog_role to app_schema;
SQL&gt; grant connect, resource to app_schema;
SQL&gt; grant dba to app_schema;
SQL&gt; grant execute on dbms_crypto to app_schema;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create a tablespace set for the sharded tables.</span><div><pre class="pre codeblock"><code>SQL&gt; CREATE TABLESPACE SET TSP_SET_1 using template (datafile size 100m autoextend on next 10M
 maxsize unlimited extent management local segment space management auto);
</code></pre><p>Specifying the shardspace is optional when creating the tablespace set. If the shardspace is not specified in the command, the default shardspace is used.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Create a tablespace for the duplicated tables.</span><div>
                              <p>In this example the duplicated table is the Products table in the sample Customers-Orders-Products schema.</p><pre class="pre codeblock"><code>SQL&gt; CREATE TABLESPACE products_tsp datafile size 100m autoextend on next 10M maxsize unlimited extent management local uniform size 1m; 
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create a sharded table for the root table.</span><div>
                              <p>In this example, the root table is the Customers table in the sample Customers-Orders-Products schema.</p><pre class="pre codeblock"><code>SQL&gt; CONNECT app_schema/<span class="variable">app_schema_password
</span>
SQL&gt; ALTER SESSION ENABLE SHARD DDL;

SQL&gt; CREATE SHARDED TABLE Customers
  (
    CustId      VARCHAR2(60) NOT NULL,
    FirstName   VARCHAR2(60),
    LastName    VARCHAR2(60),
    Class       VARCHAR2(10),
    Geo         VARCHAR2(8),
    CustProfile VARCHAR2(4000),
    Passwd      RAW(60),
    CONSTRAINT pk_customers PRIMARY KEY (CustId),
    CONSTRAINT json_customers CHECK (CustProfile IS JSON)
  ) TABLESPACE SET TSP_SET_1
  PARTITION BY CONSISTENT HASH (CustId) PARTITIONS AUTO;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create a sharded table for the other tables in the table family.</span><div>
                              <p>In this example, sharded tables are created for the Orders and LineItems tables in the sample Customers-Orders-Products schema.</p>
                              <p>The Orders sharded table is created first:</p><pre class="pre codeblock"><code>SQL&gt; CREATE SHARDED TABLE Orders
  (
    OrderId     INTEGER NOT NULL,
    CustId      VARCHAR2(60) NOT NULL,
    OrderDate   TIMESTAMP NOT NULL,
    SumTotal    NUMBER(19,4),
    Status      CHAR(4),
    CONSTRAINT  pk_orders PRIMARY KEY (CustId, OrderId),
    CONSTRAINT  fk_orders_parent FOREIGN KEY (CustId) 
    REFERENCES Customers ON DELETE CASCADE
  ) PARTITION BY REFERENCE (fk_orders_parent);
</code></pre><p>Create the sequence used for the OrderId column.</p><pre class="pre codeblock"><code>SQL&gt; CREATE SEQUENCE Orders_Seq;</code></pre><p>Create a sharded table for LineItems</p><pre class="pre codeblock"><code>SQL&gt; CREATE SHARDED TABLE LineItems
  (
    OrderId     INTEGER NOT NULL,
    CustId      VARCHAR2(60) NOT NULL,
    ProductId   INTEGER NOT NULL,
    Price       NUMBER(19,4),
    Qty         NUMBER,
    CONSTRAINT  pk_items PRIMARY KEY (CustId, OrderId, ProductId),
    CONSTRAINT  fk_items_parent FOREIGN KEY (CustId, OrderId)
    REFERENCES Orders ON DELETE CASCADE
  ) PARTITION BY REFERENCE (fk_items_parent);</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create any required duplicated tables.</span><div> 
                              <p>In this example, the Products table is a duplicated object.</p><pre class="pre codeblock"><code>SQL&gt; CREATE DUPLICATED TABLE Products
  (
    ProductId  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name       VARCHAR2(128),
    DescrUri   VARCHAR2(128),
    LastPrice  NUMBER(19,4)
  ) TABLESPACE products_tsp;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>From the shard director host, verify that there were no failures during the creation of the tablespaces.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; show ddl
id    DDL Text                                  Failed shards
--    --------                                  -------------
5     grant connect, resource to app_schema
6     grant dba to app_schema
7     grant execute on dbms_crypto to app_s... 
8     CREATE TABLESPACE SET  TSP_SET_1 usin...
9     CREATE TABLESPACE products_tsp datafi...
10    CREATE SHARDED TABLE Customers (   Cu...
11    CREATE SHARDED TABLE Orders (   Order...
12    CREATE SEQUENCE Orders_Seq;
13    CREATE SHARDED TABLE LineItems (   Or...
14    CREATE MATERIALIZED VIEW "APP_SCHEMA"...
</code></pre><div class="infoboxnote" id="GUID-61B495D3-4482-47E2-937E-B7E03286F565__GUID-57F55490-D5AB-4801-BA0D-B7D4FE6B3802">
                                 <p class="notep1">Note:</p>The <code class="codeph">show ddl</code> command output might be truncated. You can run <code class="codeph">SELECT ddl_text FROM gsmadmin_internal.ddl_requests</code> on the catalog to see the full text of the statements.
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Verify that there were no DDL errors on each of the shards.</span><div>
                              <p>Run the <code>config shard</code> and<code> config chunks</code> commands on each shard in your configuration.
                              </p><pre class="pre codeblock"><code>GDSCTL&gt; config shard -shard sh1
Name: sh1
Shard Group: primary_shardgroup
Status: Ok
State: Deployed
Region: region1
Connection string: <span class="variable">shard_host_1</span>:1521/<span class="variable">sh1_host</span>:dedicated
SCAN address: 
ONS remote port: 0
Disk Threshold, ms: 20
CPU Threshold, %: 75
Version: 12.2.0.0
<span class="bold">Last Failed DDL: 
DDL Error: ---
Failed DDL id:</span> 
Availability: ONLINE

Supported services
------------------------
Name                                          Preferred Status    
----                                          --------- ------    
oltp_ro_srvc                                  Yes       Enabled   
oltp_rw_srvc                                  Yes       Enabled  

GDSCTL&gt; config chunks
Chunks
------------------------
Database                      From      To        
--------                      ----      --        
<span class="bold">sh1                           1         6         
sh2                           1         6         
sh3                           7         12        
sh4                           7         12</span> </code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that the tablespaces of the tablespace set you created for the sharded table family and the tablespaces you created for the duplicated tables are created on all of the shards.</span><div>
                              <p>The number of tablespaces in the tablespace set is based on the number of chunks you specified in the <code>create shardcatalog</code> command.
                              </p>
                              <p>The tablespace set with the first 6 chunks of the 12 that were specified in the shard catalog creation example, and the duplicated Products tablespace is shown in the following example.</p><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; select TABLESPACE_NAME, BYTES/1024/1024 MB from sys.dba_data_files order by tablespace_name;

TABLESPACE_NAME 		    MB
----------------------- ----------
<span class="bold">C001TSP_SET_1           100
C002TSP_SET_1           100
C003TSP_SET_1			      100
C004TSP_SET_1			      100
C005TSP_SET_1			      100
C006TSP_SET_1			      100
PRODUCTS_TSP            100</span>
SYSAUX                  650
SYSTEM                  890
SYS_SHARD_TS			      100
TSP_SET_1			          100

TABLESPACE_NAME 		     MB
------------------------ ----------
UNDOTBS1			           105
USERS					             5

13 rows selected.
</code></pre><p> Repeat this step on all of the shards in your configuration.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Verify that the chunks and chunk tablespaces were created on all of the shards.</span><div><pre class="pre codeblock"><code>SQL&gt; set linesize 140
SQL&gt; column table_name format a20
SQL&gt; column tablespace_name format a20
SQL&gt; column partition_name format a20
SQL&gt; show parameter db_unique_name

NAME             TYPE        VALUE
---------------- ----------- ------------------------------
db_unique_name   string      sh1

SQL&gt; select table_name, partition_name, tablespace_name from dba_tab_partitions where tablespace_name like 'C%TSP_SET_1' order by tablespace_name;


TABLE_NAME       PARTITION_NAME   TABLESPACE_NAME
---------------- ---------------- --------------------
ORDERS           CUSTOMERS_P1     C001TSP_SET_1
CUSTOMERS        CUSTOMERS_P1     C001TSP_SET_1
LINEITEM         CUSTOMERS_P1     C001TSP_SET_1
CUSTOMERS        CUSTOMERS_P2     C002TSP_SET_1
LINEITEMS        CUSTOMERS_P2     C002TSP_SET_1
ORDERS           CUSTOMERS_P2     C002TSP_SET_1
CUSTOMERS        CUSTOMERS_P3     C003TSP_SET_1
ORDERS           CUSTOMERS_P3     C003TSP_SET_1
LINEITEMS        CUSTOMERS_P3     C003TSP_SET_1
ORDERS           CUSTOMERS_P4     C004TSP_SET_1
CUSTOMERS        CUSTOMERS_P4     C004TSP_SET_1

TABLE_NAME       PARTITION_NAME   TABLESPACE_NAME
---------------- ---------------- --------------------
LINEITEMS        CUSTOMERS_P4     C004TSP_SET_1
CUSTOMERS        CUSTOMERS_P5     C005TSP_SET_1
LINEITEMS        CUSTOMERS_P5     C005TSP_SET_1
ORDERS           CUSTOMERS_P5     C005TSP_SET_1
CUSTOMERS        CUSTOMERS_P6     C006TSP_SET_1
LINEITEMS        CUSTOMERS_P6     C006TSP_SET_1
ORDERS           CUSTOMERS_P6     C006TSP_SET_1
18 rows selected.
</code></pre><p> Repeat this step on all of the shards in your configuration.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Connect to the shard catalog database and verify that the chunks are uniformly distributed.</span><div><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; set echo off
SQL&gt; SELECT a.name Shard, COUNT(b.chunk_number) Number_of_Chunks
  FROM gsmadmin_internal.database a, gsmadmin_internal.chunk_loc b
  WHERE a.database_num=b.database_num
  GROUP BY a.name
  ORDER BY a.name;

SHARD			       NUMBER_OF_CHUNKS
------------------------------ ----------------
<span class="bold">sh1					      6
sh2					      6
sh3					      6
sh4					      6</span></code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that the sharded and duplicated tables were created.</span><div>
                              <p>Log in as the application schema user on the shard catalog database and each of the shards.</p>
                              <p>The following example shows querying the tables on a database shard as the app_schema user.</p><pre class="pre codeblock"><code>$ sqlplus app_schema/<span class="variable">app_schema_password</span>
Connected.

SQL&gt; select table_name from user_tables;

TABLE_NAME
-----------------------------------------------------------------------
CUSTOMERS
ORDERS
LINEITEMS
PRODUCTS

4 rows selected.</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that the Data Guard Broker automatic Fast-Start Failover configuration was done.</span><div><pre class="pre codeblock"><code>$ ssh os_username@shard_host_1
$ dgmgrl
DGMGRL for Linux: Release 12.2.0.0.2 - Beta on Wed Jan 20 02:49:58 2016

Copyright (c) 1982, 2015, Oracle and/or its affiliates.  All rights reserved.

Welcome to DGMGRL, type "help" for information.
DGMGRL&gt; connect sys/<span class="variable">password</span>
Connected to "sh1"
Connected as SYSDG.
DGMGRL&gt; show configuration

Configuration - sh1

  Protection Mode: MaxPerformance
  Members:
  <span class="bold">sh1 - Primary database
    sh2 - (*) Physical standby database </span>

Fast-Start Failover: <span class="bold">ENABLED</span>

Configuration Status:
<span class="bold">SUCCESS</span>   (status updated 15 seconds ago)

DGMGRL&gt; show database sh1

Database - sh1

  Role:               PRIMARY
  Intended State:     TRANSPORT-ON
  Instance(s):
    sh1

Database Status:
<span class="bold">SUCCESS</span>

DGMGRL&gt; show database sh2

Database - sh2

  Role:               PHYSICAL STANDBY
  Intended State:     APPLY-ON
  Transport Lag:      0 seconds (computed 0 seconds ago)
  Apply Lag:          0 seconds (computed 0 seconds ago)
  Average Apply Rate: 2.00 KByte/s
  Real Time Query:    ON
  Instance(s):
    sh2

Database Status:
<span class="bold">SUCCESS</span>

DGMGRL&gt; show fast_start failover

Fast-Start Failover: <span class="bold">ENABLED</span>

  Threshold:          30 seconds
  Target:             <span class="bold">sh2</span>
  Observer:           <span class="variable">shard_director_host</span>
  Lag Limit:          30 seconds
  Shutdown Primary:   TRUE
  Auto-reinstate:     TRUE
  Observer Reconnect: (none)
  Observer Override:  FALSE

Configurable Failover Conditions
  Health Conditions:
    Corrupted Controlfile          YES
    Corrupted Dictionary           YES
    Inaccessible Logfile            NO
    Stuck Archiver                  NO
    Datafile Write Errors          YES

  Oracle Error Conditions:
    (none)</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Locate the Fast-Start Failover observers.</span><div>
                              <p>Connect to the shard catalog database and run the following commands:</p><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; SELECT observer_state FROM gsmadmin_internal.broker_configs;

OBSERVER_STATE
--------------------------------------------------------------------------------
GSM server SHARDDIRECTOR2. Observer started. 
Log files at '/u01/app/oracle/product/12.2.0/gsmhome_1/network/admin/gsm_observer_1.log'.

GSM server SHARDDIRECTOR2. Observer started. 
Log files at '/u01/app/oracle/product/12.2.0/gsmhome_1/network.admin/gsm_observer_2.log'.</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-61B495D3-4482-47E2-937E-B7E03286F565__GUID-81030823-1335-4D74-8266-058942F5FFD3">
                           <p class="notep1">See Also:</p>
                           <p><a href="../gsmug/gdsctl-gds-env.html#GSMUG-GUID-C338515C-C72E-4DD8-8CB8-4737AB04046A"><span><cite>Oracle Database Global Data Services Concepts and Administration Guide</cite></span></a> for information about GDSCTL command usage
                           </p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-A3433C97-90F8-4CBF-ADA8-2AE2145612DB" name="GUID-A3433C97-90F8-4CBF-ADA8-2AE2145612DB"></a><h4 id="ADMIN-GUID-A3433C97-90F8-4CBF-ADA8-2AE2145612DB" class="sect4"><span class="enumeration_section">56.7.3 </span>System-Managed SDB Demo Application
                  </h4>
                  <div>
                     <p>The system-managed sharded database (SDB) demo application simulates the workload of an online retail store. Use it to validate the setup of any system-managed (automatic sharding) SDB configuration. The demo application also provides a practical example of sharding concepts for administrators and developers new to database sharding.</p>
                     <p>The demo application assumes that a system-managed SDB environment was already created along with the CUSTOMER table-family. The environment may have any number of chunks and shards (database nodes). When run, the application will first populate the Products table and then start a one-hour workload that can be paused at any time by the administrator. The workload includes four types of transactions: create a customer order, lookup the list of orders, create a new product, and multi-shard query with report generation. All aspects of a sharded database configuration are exercised.</p>
                     <p>You can download the demo application, along with a README file that describes how to run and monitor it, from <a href="https://support.oracle.com/CSP/main/article?cmd=show&amp;type=NOT&amp;id=2184500.1">My Oracle Support Document 2184500.1</a>.
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-C43E1E4A-DA8F-4556-9EE7-39097C0276BC" name="GUID-C43E1E4A-DA8F-4556-9EE7-39097C0276BC"></a><h3 id="ADMIN-GUID-C43E1E4A-DA8F-4556-9EE7-39097C0276BC" class="sect3"><span class="enumeration_section">56.8 </span>Deploying a Composite SDB
               </h3>
               <div>
                  <p>To deploy a composite SDB you must install the required Oracle Sharding software components, configure the objects for a composite SDB, and create the schema.</p>
                  <p>The composite sharding method allows you to create multiple shardspaces for different subsets of data in a table partitioned by consistent hash. A <span class="italic">shardspace</span> is set of shards that store data that corresponds to a range or list of key values.
                  </p>
                  <p>The following topics describe the tasks for deploying a composite SDB.</p>
               </div>
               <div>
                  <ul class="ullinks">
                     <li class="ulchildlink"><a href="sharding-deployment.html#GUID-BD9885B8-55A8-45F8-B29D-5D89BF3DB1CE">Deploying a Composite SDB</a><br>To deploy a composite SDB you create shardgroups and shards, execute the <code>DEPLOY</code> command, and create role-based global services.
                     </li>
                     <li class="ulchildlink"><a href="sharding-deployment.html#GUID-D2098302-8636-41E7-ADEA-07099C882F32">Creating a Schema for a Composite SDB</a><br>Create the schema user, tablespace set, sharded tables, and duplicated tables for the SDB. Verify that the DDLs are propagated to all of the shards, and, while connected to the shards, verify the automatic Data Guard Broker configuration with Fast-Start Failover.
                     </li>
                  </ul>
               </div>
               
               <div class="sect3"><a id="GUID-BD9885B8-55A8-45F8-B29D-5D89BF3DB1CE" name="GUID-BD9885B8-55A8-45F8-B29D-5D89BF3DB1CE"></a><h4 id="ADMIN-GUID-BD9885B8-55A8-45F8-B29D-5D89BF3DB1CE" class="sect4"><span class="enumeration_section">56.8.1 </span>Deploying a Composite SDB
                  </h4>
                  <div>
                     <p>To deploy a composite SDB you create shardgroups and shards, execute the <code>DEPLOY</code> command, and create role-based global services.
                     </p>
                     <div class="section">The examples used in this deployment procedure are based on a global distribution scenario where separate shardspaces and shardgroups are created for America and Europe.</div>
                     <!-- class="section" -->
                     <ol>
                        <li class="stepexpand"><span>Connect to a shard director host, and verify the environment variables.</span><div><pre class="pre codeblock"><code>$ ssh <span class="variable">os_user</span>@<span class="variable">shard_director_home</span>
$ env |grep ORA
ORACLE_BASE=/u01/app/oracle
ORACLE_HOME=/u01/app/oracle/product/12.2.0/gsmhome_1</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Set the global service manager for the current session, and specify the credentials to administer it.</span><div><pre class="pre codeblock"><code>$ gdsctl
GDSCTL&gt; set gsm -gsm sharddirector1
GDSCTL&gt; connect mysdbadmin/<span class="variable">mysdbadmin_password</span></code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add shardspaces and shardgroups for each customized grouping of shards your business case requires.</span><div>
                              <p>In this example the shardspaces and shardgroups are created for the America and Europe customers. You can choose your own names.</p><pre class="pre codeblock"><code>GDSCTL&gt; add shardspace -shardspace cust_america
GDSCTL&gt; add shardgroup -shardspace cust_america -shardgroup america_shgrp1 -deploy_as primary -region region1

GDSCTL&gt; add shardspace -shardspace cust_europe
GDSCTL&gt; add shardgroup -shardspace cust_europe -shardgroup europe_shgrp1 -deploy_as primary -region region2</code></pre><div class="infoboxnote" id="GUID-BD9885B8-55A8-45F8-B29D-5D89BF3DB1CE__GUID-96539EAC-394A-406F-A628-A3BC27D2FAE3">
                                 <p class="notep1">Note:</p>
                                 <p>For production deployments, additional shardgroups must be created for high availability using the <code class="codeph">add shardgroup</code> command
                                 </p>
                              </div>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Verify the shardspace and shardgroup configurations.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; config shardspace
SHARDSPACE                    Chunks                        
----------                    ------                        
cust_america                  12                            
cust_europe                   12                            
shardspaceora                 12   
 
GDSCTL&gt;config shardgroup
Shard Group         Chunks Region              SHARDSPACE          
-----------         ------ ------              ----------          
america_shgrp1      12     region1             cust_america        
europe_shgrp1       12     region2             cust_europe         
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify the sharded database configuration.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; config

Regions
------------------------
region1                       
region2                       

GSMs
------------------------
sharddirector1                
sharddirector2                

Sharded Database
------------------------
cust_sdb_comp                 

Databases
------------------------

Shard Groups
------------------------
america_shgrp1                
europe_shgrp1                 

Shard spaces
------------------------
cust_america                  
cust_europe                   
shardspaceora                 

Services
------------------------

GDSCTL pending requests
------------------------
Command                       Object                        Status                        
-------                       ------                        ------                        

Global properties
------------------------
Name: oradbcloud
Master GSM: sharddirector1
DDL sequence #: 0
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add each shard’s host address to the valid node checking for registration (VNCR) list in the catalog, then create the shard in either the primary or standby shardgroup, as shown in the following example.</span><div>
                              <div class="infoboxnote" id="GUID-BD9885B8-55A8-45F8-B29D-5D89BF3DB1CE__GUID-7FE92210-2C8A-4F7A-A230-73A8F080AF70">
                                 <p class="notep1">Note:</p>
                                 <p>The valid node checking for registration (VNCR) feature provides the ability to configure and dynamically update a set of IP addresses, host names, or subnets from which registration requests are allowed by the shard directors. Database instance registration with a shard director succeeds only when the request originates from a valid node. By default, the shard management tier (based on Oracle Global Data Services framework) automatically adds a VNCR entry for the host on which a remote database is running each time <code class="codeph">create shard</code> or <code class="codeph">add shard</code> is executed. The automation (called auto-VNCR) finds the public IP address of the target host, and automatically adds a VNCR entry for that IP address. If the host has multiple public IP addresses, then the address on which the database registers may not be the same as the address which was added using auto-VNCR and , as a result, registration many be rejected. If the target database host has multiple public IP addresses, it is advisable that you configure VNCR manually for this host using the <code class="codeph">add invitednode</code> or <code class="codeph">add invitedsubnet</code> commands in GDSCTL.
                                 </p>
                                 <p>If there are&nbsp;multiple net-cards on the target host (<code class="codeph">/sbin/ifconfig</code> returns more than one public interface), use <code class="codeph">add invitednode</code> to be safe (after finding out which interface will be used to route packets).
                                 </p>
                                 <p>If there is any doubt about registration, then use <code class="codeph">config vncr</code> and use <code class="codeph">add invitednode</code> as necessary. There is no harm in doing this, because if the node is added already, auto-VNCR ignores it, and if you try to add it after auto-VNCR already added it, you will get a warning stating that it already exists.
                                 </p>
                              </div>
                              <p>The example shows how to create four shards, two of which are in the America shardgroup and two in the Europe shardgroup. The <span class="variable">os_credential</span> is the operating system credential you created on each host.
                              </p>
                              <p>While creating the shards, you can also set the SYS password in the <code class="codeph">create shard</code> using <code class="codeph">-sys_password</code> as shown in the following example. This sets the SYS password after the shards are created when running <code class="codeph">DEPLOY</code>.
                              </p><pre class="pre codeblock"><code>GDSCTL&gt; add invitednode <span class="variable">shard_host_1</span> 
GDSCTL&gt; create shard -shardgroup america_shgrp1 -destination <span class="variable">shard_host_1</span> -credential <span class="variable">os_credential</span>-sys_password

GDSCTL&gt; add invitednode <span class="variable">shard_host_2</span>
GDSCTL&gt; create shard -shardgroup america_shgrp1 -destination <span class="variable">shard_host_2</span> -credential <span class="variable">os_credential</span>-sys_password

GDSCTL&gt; add invitednode <span class="variable">shard_host_3</span> 
GDSCTL&gt; create shard -shardgroup europe_shgrp1 -destination <span class="variable">shard_host_3</span> -credential <span class="variable">os_credential</span>-sys_password

GDSCTL&gt; add invitednode <span class="variable">shard_host_4</span>
GDSCTL&gt; create shard -shardgroup europe_shgrp1 -destination <span class="variable">shard_host_4</span> -credential <span class="variable">os_credential</span>-sys_password</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Check the configuration from a shard director.</span><div>
                              <p>Note that the shard names, sh1, sh2, sh3, and sh4, are system generated shard names.</p><pre class="pre codeblock"><code>GDSCTL&gt; config shard
Name                Shard Group         Status    State       Region    Availability 
----                -----------         ------    -----       ------    ------------ 
sh1                 america_shgrp1      U         none        region1   -            
sh2                 america_shgrp1      U         none        region1   -            
sh3                 europe_shgrp1       U         none        region2   -            
sh4                 europe_shgrp1       U         none        region2   -            

GDSCTL&gt; config vncr
Name    Group ID 
----    --------
shard_host_1
shard_host_2
shard_host_3
shard_host_4
shard_catalog_host_IP
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Run the <code>DEPLOY</code> command to create the shards.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; deploy</code></pre><p>The <code>DEPLOY</code> command takes some time to run, approximately 15 to 30 minutes. The <code>DEPLOY</code> command creates the shards using DBCA.
                              </p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Verify that all of the shards are deployed.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; config shard
Name                Shard Group         Status    State       Region    Availability 
----                -----------         ------    -----       ------    ------------ 
sh1                 america_shgrp1      Ok        Deployed    region1   ONLINE       
sh2                 america_shgrp1      Ok        Deployed    region1   ONLINE       
sh3                 europe_shgrp1       Ok        Deployed    region2   ONLINE       
sh4                 europe_shgrp1       Ok        Deployed    region2   ONLINE </code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that all of the shards are registered.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; databases
Database: "sh1" Registered: Y State: Ok ONS: N. Role: PRIMARY Instances: 1 Region: region1
   Registered instances:
     cust_sdb_comp%1
Database: "sh2" Registered: Y State: Ok ONS: N. Role: PRIMARY Instances: 1 Region: region1
   Registered instances:
     cust_sdb_comp%11
Database: "sh3" Registered: Y State: Ok ONS: N. Role: PRIMARY Instances: 1 Region: region2
   Registered instances:
     cust_sdb_comp%21
Database: "sh4" Registered: Y State: Ok ONS: N. Role: PRIMARY Instances: 1 Region: region2
   Registered instances:
     cust_sdb_comp%31
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Check the configuration of a shard.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; config shard -shard sh1
Name: sh1
Shard Group: america_shgrp1
Status: Ok
State: Deployed
Region: region1
Connection string: shard1:1521/sh1:dedicated
SCAN address: 
ONS remote port: 0
Disk Threshold, ms: 20
CPU Threshold, %: 75
Version: 12.2.0.0
Last Failed DDL: 
DDL Error: ---
Failed DDL id: 
Availability: ONLINE


Supported services
------------------------
Name                                                            Preferred Status    
----                                                            --------- ------
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Add a global service that runs on all of the primary shards. </span><div>
                              <p>The oltp_rw_srvc global service is the global data services listener that helps route a connection from the client to the actual database. The oltp_rw_srvc service runs the OLTP transactions on the primary shards.</p><pre class="pre codeblock"><code>GDSCTL&gt; add service -service oltp_rw_srvc
GDSCTL&gt; config service 

Name           Network name                  Pool           Started Preferred all 
----           ------------                  ----           ------- ------------- 
oltp_rw_srvc   oltp_rw_srvc.cust_sdb_comp.or cust_sdb_comp  No      Yes           
               adbcloud   
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Start the oltp_rw_srvc global service.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; start service -service oltp_rw_srvc

GDSCTL&gt; status service
Service "oltp_rw_srvc.cust_sdb_comp.oradbcloud" has 4 instance(s). Affinity: ANYWHERE
   Instance "cust_sdb_comp%1", name: "sh1", db: "sh1", region: "region1", status: ready.
   Instance "cust_sdb_comp%11", name: "sh2", db: "sh2", region: "region1", status: ready.
   Instance "cust_sdb_comp%21", name: "sh3", db: "sh3", region: "region2", status: ready.
   Instance "cust_sdb_comp%31", name: "sh4", db: "sh4", region: "region2", status: ready. 
</code></pre></div>
                        </li>
                     </ol>
                     <div class="section">
                        <div class="infoboxnotealso" id="GUID-BD9885B8-55A8-45F8-B29D-5D89BF3DB1CE__GUID-E0A1E37B-F524-4407-A925-3FCBF53C3379">
                           <p class="notep1">See Also:</p>
                           <p><a href="../gsmug/gdsctl-gds-env.html#GSMUG-GUID-C338515C-C72E-4DD8-8CB8-4737AB04046A"><span><cite>Oracle Database Global Data Services Concepts and Administration Guide</cite></span></a></p>
                        </div>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D2098302-8636-41E7-ADEA-07099C882F32" name="GUID-D2098302-8636-41E7-ADEA-07099C882F32"></a><h4 id="ADMIN-GUID-D2098302-8636-41E7-ADEA-07099C882F32" class="sect4"><span class="enumeration_section">56.8.2 </span>Creating a Schema for a Composite SDB
                  </h4>
                  <div>
                     <p>Create the schema user, tablespace set, sharded tables, and duplicated tables for the SDB. Verify that the DDLs are propagated to all of the shards, and, while connected to the shards, verify the automatic Data Guard Broker configuration with Fast-Start Failover.</p>
                     <ol>
                        <li class="stepexpand"><span>Connect to the shard catalog host, and set the ORACLE_SID to the shard catalog name.</span></li>
                        <li class="stepexpand"><span>Connect to the shard catalog database, create the application schema user, and grant privileges and roles to the user.</span><div>
                              <p>In this example, the application schema user is called app_schema.</p><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; connect / as sysdba
SQL&gt; alter session enable shard ddl;
SQL&gt; create user app_schema identified by <span class="variable">app_schema_password</span>;
SQL&gt; grant connect, resource, alter session to app_schema;
SQL&gt; grant execute on dbms_crypto to app_schema;
SQL&gt; grant create table, create procedure, create tablespace, create materialized view to app_schema;
SQL&gt; grant unlimited tablespace to app_schema;
SQL&gt; grant select_catalog_role to app_schema;
SQL&gt; grant all privileges to app_schema;
SQL&gt; grant gsmadmin_role to app_schema;
SQL&gt; grant dba to app_schema;
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create tablespace sets for the sharded tables.</span><div><pre class="pre codeblock"><code>SQL&gt; CREATE TABLESPACE SET  
  TSP_SET_1 in shardspace cust_america using template
  (datafile size 100m autoextend on next 10M maxsize
   unlimited extent management
   local segment space management auto );

SQL&gt; CREATE TABLESPACE SET
  TSP_SET_2 in shardspace cust_europe using template
  (datafile size 100m autoextend on next 10M maxsize
   unlimited extent management
   local segment space management auto );</code></pre><p>Specifying the shardspace is optional when creating the tablespace set. If the shardspace is not specified in the command, the default shardspace is used.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Create a tablespace for the duplicated tables.</span><div>
                              <p>In this example the duplicated table is the Products table in the sample Customers-Orders-Products schema.</p><pre class="pre codeblock"><code>CREATE TABLESPACE products_tsp datafile size 100m autoextend on next 10M maxsize unlimited extent management local uniform size 1m;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create a sharded table for the root table.</span><div>
                              <p>In this example, the root table is the Customers table in the sample Customers-Orders-Products schema.</p><pre class="pre codeblock"><code>connect app_schema/<span class="variable">app_schema_password</span>
alter session enable shard ddl;

CREATE SHARDED TABLE Customers
(
  CustId      VARCHAR2(60) NOT NULL,
  FirstName   VARCHAR2(60),
  LastName    VARCHAR2(60),
  Class       VARCHAR2(10),
  Geo         VARCHAR2(8),
  CustProfile VARCHAR2(4000),
  Passwd      RAW(60),
  CONSTRAINT pk_customers PRIMARY KEY (CustId),
  CONSTRAINT json_customers CHECK (CustProfile IS JSON)
) partitionset by list(GEO)
partition by consistent hash(CustId)
partitions auto
(partitionset america values ('AMERICA') tablespace set tsp_set_1,
partitionset europe values ('EUROPE') tablespace set tsp_set_2
);
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create a sharded table for the other tables in the table family.</span><div>
                              <p>In this example, sharded tables are created for the Orders and LineItems tables in the sample Customers-Orders-Products schema.</p>
                              <p>Create the sequence used for the OrderId column.</p><pre class="pre codeblock"><code>CREATE SEQUENCE Orders_Seq;
</code></pre><p>The Orders sharded table is created first:</p><pre class="pre codeblock"><code>CREATE SHARDED TABLE Orders
(
  OrderId     INTEGER NOT NULL,
  CustId      VARCHAR2(60) NOT NULL,
  OrderDate   TIMESTAMP NOT NULL,
  SumTotal    NUMBER(19,4),
  Status      CHAR(4),
  constraint  pk_orders primary key (CustId, OrderId),
  constraint  fk_orders_parent foreign key (CustId) 
    references Customers on delete cascade
) partition by reference (fk_orders_parent);
</code></pre><p>Create a sharded table for LineItems</p><pre class="pre codeblock"><code>CREATE SHARDED TABLE LineItems
(
  OrderId     INTEGER NOT NULL,
  CustId      VARCHAR2(60) NOT NULL,
  ProductId   INTEGER NOT NULL,
  Price       NUMBER(19,4),
  Qty         NUMBER,
  constraint  pk_items primary key (CustId, OrderId, ProductId),
  constraint  fk_items_parent foreign key (CustId, OrderId)
    references Orders on delete cascade
) partition by reference (fk_items_parent);</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Create any required duplicated tables.</span><div> 
                              <p>In this example, the Products table is a duplicated object.</p><pre class="pre codeblock"><code>CREATE DUPLICATED TABLE Products
(
  ProductId  INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  Name       VARCHAR2(128),
  DescrUri   VARCHAR2(128),
  LastPrice  NUMBER(19,4)
) tablespace products_tsp;</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>From the shard director host, verify that there were no failures during the creation of the tablespaces.</span><div><pre class="pre codeblock"><code>GDSCTL&gt; show ddl
id      DDL Text                                 Failed shards 
--      --------                                 ------------- 
11      CREATE TABLESPACE SET  TSP_SET_2 in s...               
12      CREATE TABLESPACE products_tsp datafi...               
13      CREATE SHARDED TABLE Customers (   Cu...               
14      CREATE SEQUENCE Orders_Seq;                            
15      CREATE SHARDED TABLE Orders (   Order...               
16      CREATE SHARDED TABLE LineItems (   Or...               
17      create database link "PRODUCTSDBLINK@...               
18      CREATE MATERIALIZED VIEW "PRODUCTS"  ...               
19      CREATE OR REPLACE FUNCTION PasswCreat...               
20      CREATE OR REPLACE FUNCTION PasswCheck...     
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that there were no DDL errors on each of the shards.</span><div>
                              <p>Run the <code>config shard</code> and<code> config chunks</code> commands on each shard in your configuration.
                              </p><pre class="pre codeblock"><code>GDSCTL&gt; config shard -shard sh1
Name: sh1
Shard Group: america_shgrp1
Status: Ok
State: Deployed
Region: region1
Connection string: shard1:1521/sh1:dedicated
SCAN address: 
ONS remote port: 0
Disk Threshold, ms: 20
CPU Threshold, %: 75
Version: 12.2.0.0
Last Failed DDL: 
DDL Error: ---
Failed DDL id: 
Availability: ONLINE


Supported services
------------------------
Name                                                            Preferred Status    
----                                                            --------- ------    
oltp_rw_srvc                                                    Yes       Enabled  

GDSCTL&gt; config chunks
Chunks
------------------------
Database                      From      To        
--------                      ----      --        
sh1                           1         6         
sh2                           7         12        
sh3                           1         6         
sh4                           7         12
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that the tablespaces of the tablespace set you created for the sharded table family and the tablespaces you created for the duplicated tables are created on all of the shards.</span><div>
                              <p>The number of tablespaces in the tablespace set is based on the number of chunks you specified in the <code>create shardcatalog</code> command.
                              </p>
                              <p>The tablespace set with the first 6 chunks of the 12 that were specified in the shard catalog creation example, and the duplicated Products tablespace is shown in the following example on the shard_host_1.</p><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; select TABLESPACE_NAME, BYTES/1024/1024 MB from sys.dba_data_files order by tablespace_name;

TABLESPACE_NAME 		       MB
------------------------------ ----------
C001TSP_SET_1			      100
C002TSP_SET_1			      100
C003TSP_SET_1			      100
C004TSP_SET_1			      100
C005TSP_SET_1			      100
C006TSP_SET_1			      100
PRODUCTS_TSP			      100
SYSAUX				      650
SYSTEM				      890
SYS_SHARD_TS			      100
TSP_SET_1			      100

TABLESPACE_NAME 		       MB
------------------------------ ----------
TSP_SET_2			      100
UNDOTBS1			      110
USERS					5

14 rows selected.
</code></pre><p> Repeat this step on all of the shards in your configuration.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Verify that the chunks and chunk tablespaces were created on all of the shards.</span><div><pre class="pre codeblock"><code>SQL&gt; set linesize 140
SQL&gt; column table_name format a20
SQL&gt; column tablespace_name format a20
SQL&gt; column partition_name format a20
SQL&gt; show parameter db_unique_name
NAME				     TYPE	 VALUE
------------------------------------ ----------- ------------------------------
db_unique_name			     string	 sh2


SQL&gt; select table_name, partition_name, tablespace_name from dba_tab_partitions where tablespace_name like 'C%TSP_SET_1' order by tablespace_name;

TABLE_NAME	     PARTITION_NAME	  TABLESPACE_NAME
-------------------- -------------------- --------------------
LINEITEMS	     CUSTOMERS_P7	  C007TSP_SET_1
CUSTOMERS	     CUSTOMERS_P7	  C007TSP_SET_1
ORDERS		     CUSTOMERS_P7	  C007TSP_SET_1
CUSTOMERS	     CUSTOMERS_P8	  C008TSP_SET_1
LINEITEMS	     CUSTOMERS_P8	  C008TSP_SET_1
ORDERS		     CUSTOMERS_P8	  C008TSP_SET_1
LINEITEMS	     CUSTOMERS_P9	  C009TSP_SET_1
CUSTOMERS	     CUSTOMERS_P9	  C009TSP_SET_1
ORDERS		     CUSTOMERS_P9	  C009TSP_SET_1
CUSTOMERS	     CUSTOMERS_P10	  C00ATSP_SET_1
LINEITEMS	     CUSTOMERS_P10	  C00ATSP_SET_1

TABLE_NAME	     PARTITION_NAME	  TABLESPACE_NAME
-------------------- -------------------- --------------------
ORDERS		     CUSTOMERS_P10	  C00ATSP_SET_1
CUSTOMERS	     CUSTOMERS_P11	  C00BTSP_SET_1
LINEITEMS	     CUSTOMERS_P11	  C00BTSP_SET_1
ORDERS		     CUSTOMERS_P11	  C00BTSP_SET_1
CUSTOMERS	     CUSTOMERS_P12	  C00CTSP_SET_1
LINEITEMS	     CUSTOMERS_P12	  C00CTSP_SET_1
ORDERS		     CUSTOMERS_P12	  C00CTSP_SET_1

18 rows selected.
</code></pre><p> Repeat this step on all of the shards in your configuration.</p>
                           </div>
                        </li>
                        <li class="stepexpand"><span>Connect to the shard catalog database and verify that the chunks are uniformly distributed.</span><div><pre class="pre codeblock"><code>$ sqlplus / as sysdba

SQL&gt; set echo off
SQL&gt; select a.name Shard,  count( b.chunk_number) Number_of_Chunks from  gsmadmin_internal.database a, gsmadmin_internal.chunk_loc b where
 a.database_num=b.database_num  group by a.name;

SHARD			       NUMBER_OF_CHUNKS
------------------------------ ----------------
sh1					      6
sh2					      6
sh3					      6
sh4					      6
</code></pre></div>
                        </li>
                        <li class="stepexpand"><span>Verify that the sharded and duplicated tables were created.</span><div>
                              <p>Log in as the application schema user on the shard catalog database and each of the shards.</p>
                              <p>The following example shows querying the tables on a database shard as the app_schema user.</p><pre class="pre codeblock"><code>$ sqlplus app_schema/<span class="variable">app_schema_password</span>
Connected.
SQL&gt; select table_name from user_tables;

TABLE_NAME
-----------------------------------------------------------------------
CUSTOMERS
ORDERS
LINEITEMS
PRODUCTS

4 rows selected.</code></pre></div>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>