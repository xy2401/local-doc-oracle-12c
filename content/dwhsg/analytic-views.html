<!DOCTYPE html
  SYSTEM "about:legacy-compat">

<!-- saved from url=(0023)https://docs.oracle.com -->

<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="abstract" content="An analytic view encapsulates aggregations, calculations, and joins of fact data that are specified by attribute dimensions and hierarchies and by measures.">
      <meta name="description" content="An analytic view encapsulates aggregations, calculations, and joins of fact data that are specified by attribute dimensions and hierarchies and by measures.">
      <title>Analytic View Objects</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Database Data Warehousing Guide">
      <meta property="og:description" content="An analytic view encapsulates aggregations, calculations, and joins of fact data that are specified by attribute dimensions and hierarchies and by measures.">
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Database Data Warehousing Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 17.8.1">
      <link rel="alternate" href="database-data-warehousing-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-01-04T06:07:35-08:00">
      <meta name="dcterms.title" content="Database Data Warehousing Guide">
      <meta name="dcterms.dateCopyrighted" content="2001, 2018">
      <meta name="dcterms.category" content="database">
      <meta name="dcterms.identifier" content="E85643-03">
      
      <meta name="dcterms.product" content="en/database/oracle/oracle-database/12.2">
      <meta name="dcterms.release" content="Release 12.2">
      <link rel="prev" href="analytic-view-attribute-dimensions.html" title="Previous" type="text/html">
      <link rel="next" href="glossary.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">
            {
                "primary":
                {
                    "category":{
                      "short_name":"database",
                      "element_name":"Database",
                      "display_in_url":true
                    },
                    "suite":{
                      "short_name":"oracle",
                      "element_name":"Oracle",
                      "display_in_url":true
                    },
                    "product_group":{
                      "short_name":"not-applicable",
                      "element_name":"Not applicable",
                      "display_in_url":false
                    },
                    "product":{
                      "short_name":"oracle-database",
                      "element_name":"Oracle Database",
                      "display_in_url":true
                    },
                    "release":{
                      "short_name":"12.2",
                      "element_name":"Release 12.2",
                      "display_in_url":true
                    },
                    "platform":{
                      "short_name":"",
                      "element_name":"",
                      "display_in_url":false
                    },
                    "component":{
                      "short_name":"",
                      "element_name":"",
                      "display_in_url":false
                    }
                }
            }
            </script>
      
    <meta name="dcterms.isVersionOf" content="DWHSG">
  </head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="analytic-view-attribute-dimensions.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="glossary.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Database Data Warehousing Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="part-analytic-views.html" property="item" typeof="WebPage"><span property="name">Analytic Views</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Analytic View Objects</li>
            </ol>
            <a id="GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601" name="GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601"></a>
            
            <h2 id="DWHSG-GUID-3FF2F855-ACB3-43A3-9D7B-C319F821B601" class="sect2"><span class="enumeration_chapter">26 </span>Analytic View Objects
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>An analytic view encapsulates aggregations, calculations, and joins of fact data that are specified by attribute dimensions and hierarchies and by measures.</p>
               <p>An analytic view can be used in the <code class="codeph">FROM</code> clause of a SQL <code class="codeph">SELECT</code> statement.
               </p>
               <p>Analytic views are described in the following topics.</p>
               <ul style="list-style-type: disc;">
                  <li>
                     <p><a href="analytic-views.html#GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" title="An analytic view specifies the source of its fact data and defines measures that describe calculations or other analytic operations to perform on the data.">About Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-views.html#GUID-C237526A-FE9C-4213-9B7F-AACB28297D2B" title="The attribute dimensions determined by hierarchies provide the dimension table columns for analytic views.">Attribute Dimensions and Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-views.html#GUID-4950FBDB-A78F-488F-879D-EFA00F7B0EB0" title="For each attribute dimension specified in a dim_key clause, an analytic view must include at least one hierarchy that uses it.">Hierarchies of Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-views.html#GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" title="Analytic view measures specify fact data and the calculations or other operations to perform on the data.">Measures of Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-views.html#GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" title="In creating an analytic view, you specify one or more hierarchies and a fact table that has at least one measure column that can join to each hierarchy.">Create Analytic Views</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-views.html#GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" title="Calculated measures are expressions you add to a MEASURES clause of an analytic view in the form of measure_name AS (expression).">Examples of Calculated Measures</a></p>
                  </li>
                  <li>
                     <p><a href="analytic-views.html#GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" title="You can use any attribute of an attribute dimension in a hierarchy and aggregate data for it in an analytic view,.">Attribute Reporting</a></p>
                  </li>
               </ul>
            </div><a id="RESOURCEID-186323-7FDC9206"></a><div class="sect2"><a id="GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" name="GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2"></a><h3 id="DWHSG-GUID-EE854CA8-9BE5-4BF8-AFC9-C3B020B06DE2" class="sect3"><span class="enumeration_section">26.1 </span>About Analytic Views
               </h3>
               <div>
                  <div><span>An analytic view specifies the source of its fact data and defines measures that describe calculations or other analytic operations to perform on the data.</span>An analytic view also specifies the attribute dimensions and hierarchies that define the rows of the analytic view.
                  </div>
                  <p>Measures of an analytic view may be derived directly from a column in a fact table or they may be calculated expressions. The rows produced by a query of the analytic view are determined by the rows in the fact table and the aggregate rows provided by hierarchies. Measure calculations affect the columns in the analytic view.</p>
                  <p>A cell (or row) of the analytic view is uniquely identified by the combination of the <code class="codeph">MEMBER_UNIQUE_NAME</code> attributes of each of the hierarchies. The metadata for the analytic view contains information about which columns in the fact table are joined to columns in the attribute dimensions for a hierarchy.
                  </p>
                  <p>An analytic view is defined by specifying the following: </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>The data source</p>
                     </li>
                     <li>
                        <p>Fact columns from the data source</p>
                     </li>
                     <li>
                        <p>Attribute dimensions with attributes that correspond to the fact columns and that determine the rows of the analytic view</p>
                     </li>
                     <li>
                        <p>Hierarchies that participate in the analytic view</p>
                     </li>
                     <li>
                        <p>Any number of measures</p>
                     </li>
                  </ul>
                  <p>An analytic view also has the following optional characteristics:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Can specify sharing its metadata or itself with an application container</p>
                     </li>
                     <li>
                        <p>Can specify a materialized view as a cache for the aggregated values of one or more measures.</p>
                     </li>
                  </ul>
               </div>
            </div><a id="RESOURCEID-186423-7FDC957B"></a><div class="sect2"><a id="GUID-C237526A-FE9C-4213-9B7F-AACB28297D2B" name="GUID-C237526A-FE9C-4213-9B7F-AACB28297D2B"></a><h3 id="DWHSG-GUID-C237526A-FE9C-4213-9B7F-AACB28297D2B" class="sect3"><span class="enumeration_section">26.2 </span>Attribute Dimensions and Analytic Views
               </h3>
               <div>
                  <p>The attribute dimensions determined by hierarchies provide the dimension table columns for analytic views.</p>
                  <p>Typically, there is one attribute dimension for each dimension table in the star schema.</p>
                  <p>You specify an attribute dimension with a <code class="codeph">dim_key</code> clause in the analytic view definition. You may specify an optional alias, which is required if you use the same attribute dimension more than once or if you use an attribute dimension with the same name from a different schema.
                  </p>
                  <p>In the <code class="codeph">dim_key</code> clause, with the <code class="codeph">KEY</code> keyword you specify one or more fact columns from the data source that you are using. With the <code class="codeph">REFERENCES</code> clause, you specify the attributes to which the <code class="codeph">KEY</code> joins. The attributes must be either a key or alternate key attribute of a level. You may specify the same attribute dimension multiple times, as long as you give each instance a unique alias.
                  </p>
                  <p>Each <code class="codeph">dim_key</code> clause must include at least one hierarchy, which you specify in the <code class="codeph">HIERARCHIES</code> clause. You may specify a hierarchy as the default hierarchy for the analytic view; otherwise, the first hierarchy in the definition is the default.
                  </p>
               </div>
            </div><a id="RESOURCEID-186523-7FDCB139"></a><div class="sect2"><a id="GUID-4950FBDB-A78F-488F-879D-EFA00F7B0EB0" name="GUID-4950FBDB-A78F-488F-879D-EFA00F7B0EB0"></a><h3 id="DWHSG-GUID-4950FBDB-A78F-488F-879D-EFA00F7B0EB0" class="sect3"><span class="enumeration_section">26.3 </span>Hierarchies of Analytic Views
               </h3>
               <div>
                  <p>For each attribute dimension specified in a <code class="codeph">dim_key</code> clause, an analytic view must include at least one hierarchy that uses it.
                  </p>
                  <p>Each hierarchy forms another component of the overall contents of the analytic view. Each attribute dimension specified in the analytic view has one of the associated hierarchies designated as the default hierarchy. You can specify a default hierarchy with the <code class="codeph">DEFAULT</code> keyword in the <code class="codeph">hier_ref</code> clause; otherwise, the first hierarchy in the list is the default. 
                  </p>
                  <p>When an analytic view is queried, all hierarchies not referenced in the <code class="codeph">HIERARCHIES</code> phrase of the <code class="codeph">FROM</code> clause of the query are reduced to a single member that represents the aggregate value of that hierarchy. You can reference the columns of such a hierarchy in the query, but only one of the rows is exposed through the analytic view. The particular member chosen for that hierarchy depends on the other hierarchies defined using the same attribute dimension.
                  </p>
                  <p>Every hierarchy includes an ALL member, which is the only member of the ALL level, and is the single root member of the hierarchy (that is, ALL is an ancestor of every other member in the hierarchy). Therefore, even if members at certain levels in a hierarchy do not determine members at any explicitly defined levels in any other hierarchy, they always at least determine the ALL member.</p>
                  <p>In a query, only one default hierarchy per attribute dimension is included. You can override the default hierarchies and specify any set of default hierarchies for an attribute dimension. You can specify multiple hierarchies for some attribute dimensions of an analytic view and not specify hierarchies for others. To override a default hierarchy, in the <code class="codeph">FROM</code> clause of a <code class="codeph">SELECT</code> statement, use the <code class="codeph">HIERARCHIES</code> phrase to specify one or more hierarchies.
                  </p>
               </div>
            </div><a id="RESOURCEID-186623-7FDCA04F"></a><div class="sect2"><a id="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" name="GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03"></a><h3 id="DWHSG-GUID-E6A33251-56D4-4F3D-9C00-BB1160CBBC03" class="sect3"><span class="enumeration_section">26.4 </span>Measures of Analytic Views
               </h3>
               <div>
                  <p>Analytic view measures specify fact data and the calculations or other operations to perform on the data. </p>
                  <p>In an analytic view definition, you can specify a base measure or a calculated measure.</p>
                  <div class="section">
                     <p class="subhead2">Base Measures</p>
                     <p>A base measure is a reference to a column in a fact table. You can optionally specify a <code class="codeph">meas_aggregate_clause</code>, which overrides the default aggregation method of the analytic view. Each base measure can specify a default aggregation. The aggregation may be a simple operation like <code class="codeph">SUM</code> or <code class="codeph">AVG</code>, or a complex nesting of operations that vary by attribute dimension.
                     </p>
                     <p>You can use the <code class="codeph">default_aggregate_clause</code> to specify a default aggregation method for base measures that don't have a <code class="codeph">meas_aggregate_clause</code>. The default value of the <code class="codeph">default_aggregate_clause</code> is <code class="codeph">SUM</code>.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="section">
                     <p class="subhead2">Calculated Measures</p>
                     <p>A calculated measure is an expression that can be a user-defined expression or one of the many pre-defined analytic calculations. A calculated measure expression may include other measures, row functions, and hierarchy functions. Hierarchy functions allow computations based on identifying and processing related members in a hierarchy. The expression may reference other measures in the analytic view, but may not reference fact columns. Because a calculation can refer to other measures, you can easily build complex calculations through nesting.</p>
                     <p>In defining a calculated measure expression, you may use any other measure in the analytic view, irrespective of the order in which you defined the measures of the analytic view. The only restriction is that no cycles may be introduced in the calculations.</p>
                     <p>Categories of calculated measure expressions are the following:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Analytic view measure expressions</p>
                        </li>
                        <li>
                           <p>Analytic view simple expressions</p>
                        </li>
                        <li>
                           <p>Single row function expressions</p>
                        </li>
                        <li>
                           <p>Compound expressions</p>
                        </li>
                        <li>
                           <p>Datetime expressions</p>
                        </li>
                        <li>
                           <p>Interval expressions</p>
                        </li>
                     </ul>
                     <p>Analytic view measure expressions include the following operations:</p>
                     <ul style="list-style-type: disc;">
                        <li>
                           <p>Lead and lag</p>
                        </li>
                        <li>
                           <p>Related member</p>
                        </li>
                        <li>
                           <p>Window calculations</p>
                        </li>
                        <li>
                           <p>Share of</p>
                        </li>
                        <li>
                           <p>Qualified data reference (QDR)</p>
                        </li>
                     </ul>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" name="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B"></a><h3 id="DWHSG-GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B" class="sect3"><span class="enumeration_section">26.5 </span>Create Analytic Views
               </h3>
               <div>
                  <p>In creating an analytic view, you specify one or more hierarchies and a fact table that has at least one measure column that can join to each hierarchy.</p>
                  <div class="section">
                     <p class="subhead2">Create a Simple Analytic View</p>
                     <p>An analytic view must have a reference to a fact table and a measure that can join to a hierarchy.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-3E323FF9-5FED-4485-8E1C-E92857E78508">
                     <p class="titleinexample">Example 26-1 Creating a Simple Analytic View</p>
                     <p>This analytic view uses the TIME_HIER hierarchy and the SALE_FACT table.  It contains a single measure, SALES.</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact                      -- Refers to the SALES_FACT table
DIMENSION BY                          -- List of attribute dimensions
  (time_attr_dim                      -- TIME_ATTR_DIM attribute dimension
    KEY month_id REFERENCES month_id  -- Dimension KEY joins to fact column
    HIERARCHIES (                     -- List of hierarchies that use 
      time_hier DEFAULT))             -- the attribute dimension
MEASURES                              -- List of measures
 (sales FACT sales)                   -- SALES measure references SALES column
DEFAULT MEASURE SALES;                -- Default measure of the analytic view
</code></pre><p>A query that selects from an analytic view that does not include filters has the potential of returning large numbers of rows. However, in this query, the SALES_AV analytic view includes a single hierarchy that returns only returns 86 rows.</p><pre class="pre codeblock"><code>SELECT *
  FROM sales_av HIERARCHIES(time_hier)
  ORDER BY time_hier.hier_order;</code></pre><p>This is a excerpt of the returned values.</p><img src="img/simple_av_sel.png" alt="Description of simple_av_sel.png follows" title="Description of simple_av_sel.png follows" longdesc="img_text/simple_av_sel.html"><br><a href="img_text/simple_av_sel.html">Description of the illustration simple_av_sel.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2">Add Another Base Measure</p>
                     <p>To add another base measure to an analytic view, include the measure in the <code class="codeph">MEASURES</code> list.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-7527476C-452D-4D6A-AC84-9D397589D0AA">
                     <p class="titleinexample">Example 26-2 Adding a Base Measure to an Analytic View</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT))
MEASURES
 (sales FACT sales,
  units FACT units)                   -- Add the UNITS base measure
DEFAULT MEASURE SALES;</code></pre><p>Because a query of the analytic view could return a great many rows, a query typically uses filters to limit the results. In the <code class="codeph">WHERE</code> clause, this query filters the time periods to those in the YEAR level, so it returns only SALES and UNITS data at that level..
                     </p><pre class="pre codeblock"><code>SELECT time_hier.member_name as TIME,
 sales,
 units
FROM
 sales_av HIERARCHIES(time_hier)
WHERE time_hier.level_name = 'YEAR'
ORDER BY time_hier.hier_order;
</code></pre><p>These are the returned values.</p><img src="img/av_sel_2measures.png" alt="Description of av_sel_2measures.png follows" title="Description of av_sel_2measures.png follows" longdesc="img_text/av_sel_2measures.html"><br><a href="img_text/av_sel_2measures.html">Description of the illustration av_sel_2measures.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2">Add Hierarchies to an Analytic View</p>
                     <p>Typically, an analytic view has more than one hierarchy from one or more attribute dimensions.</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-D2FB08A9-1CB7-4638-88E9-C9BD8DF3515B__GUID-C7978C62-E297-4C66-9301-56C4BE1ED427">
                     <p class="titleinexample">Example 26-3 Adding Hierarchies to an Analytic View</p>
                     <p>This example adds attribute dimensions and hierarchies to the <code class="codeph">DIMENSION BY</code> list of the analytic view.
                     </p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id 
    REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units
  )
DEFAULT MEASURE SALES;</code></pre><p>The following query adds the PRODUCT_HIER and GEOGRAPHY_HIER hierarchies to the <code class="codeph">HIERARCHIES</code> phrase of the <code class="codeph">FROM</code> clause.
                     </p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time,
 product_hier.member_name AS Product,
 geography_hier.member_name AS Geography,
 sales,
 units
FROM
 sales_av HIERARCHIES (time_hier, product_hier, geography_hier)
WHERE time_hier.level_name in ('YEAR')
  AND product_hier.level_name in ('DEPARTMENT')
  AND geography_hier.level_name in ('REGION')
ORDER BY time_hier.hier_order,
  product_hier.hier_order,
  geography_hier.hier_order;</code></pre><p>The query returns 50 rows. The following image shows only the first 20 rows.</p><img src="img/av_sel_all_hiers.png" alt="Description of av_sel_all_hiers.png follows" title="Description of av_sel_all_hiers.png follows" longdesc="img_text/av_sel_all_hiers.html"><br><a href="img_text/av_sel_all_hiers.html">Description of the illustration av_sel_all_hiers.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>You can view and run SQL scripts that create the tables, the analytic view component objects, and the queries used in the examples from the Oracle Live SQL website at <a href="https://livesql.oracle.com/apex/livesql/file/index.html">https://livesql.oracle.com/apex/livesql/file/index.html</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" name="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529"></a><h3 id="DWHSG-GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529" class="sect3"><span class="enumeration_section">26.6 </span>Examples of Calculated Measures
               </h3>
               <div>
                  <p>Calculated measures are expressions you add to a <code class="codeph">MEASURES</code> clause of an analytic view in the form of <span class="italic"><code class="codeph">measure_name</code></span> <code class="codeph">AS</code> <code class="codeph">(<span class="codeinlineitalic">expression</span>)</code>.
                  </p>
                  <div class="section">
                     <p class="subhead2">Add a LAG Expression</p>
                     <p>This example adds a calculated measure that uses a <code class="codeph">LAG</code> operation to the SALES_AV analytic view.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-7F1BE548-BECB-4589-85EA-AA1B72A54EAA">
                     <p class="titleinexample">Example 26-4 Adding a LAG Expression</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units,
  sales_prior_period AS       -- Add a calculated measure.
    (LAG(sales) OVER (HIERARCHY time_hier OFFSET 1))
  )
DEFAULT MEASURE SALES;</code></pre><p>Select the SALES and SALES_PRIOR_PERIOD measures at the YEAR and QUARTER levels.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name as TIME,
 sales,
 sales_prior_period
FROM
 sales_av HIERARCHIES(time_hier)
WHERE time_hier.level_name IN ('YEAR','QUARTER')
ORDER BY time_hier.hier_order;
</code></pre><p>In this excerpt from the query results, note that the <code class="codeph">LAG</code> expression returns prior periods within the same level.
                     </p><img src="img/av_calc_meas_lag.png" alt="Description of av_calc_meas_lag.png follows" title="Description of av_calc_meas_lag.png follows" longdesc="img_text/av_calc_meas_lag.html"><br><a href="img_text/av_calc_meas_lag.html">Description of the illustration av_calc_meas_lag.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2">SHARE OF Expressions</p>
                     <p>Share of measures calculate the ratio of a current row to a parent row, ancestor row, or all rows in the current level; for example, the ratio of a geography member to the parent of the member.  Share of measures are specified using the <code class="codeph">SHARE</code> <code class="codeph">OF</code> expression.
                     </p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-015E9CA4-DFBF-4467-9AE9-DB8104E4019D">
                     <p class="titleinexample">Example 26-5 Using SHARE OF Expressions</p>
                     <p>This example adds calculated measures that use <code class="codeph">SHARE</code> <code class="codeph">OF</code> operations to the SALES_AV analytic view.
                     </p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units,
  -- Share of calculations
 sales_shr_parent_prod AS
   (SHARE_OF(sales HIERARCHY product_hier PARENT)),
 sales_shr_parent_geog AS
   (SHARE_OF(sales HIERARCHY geography_hier PARENT)),
 sales_shr_region AS
   (SHARE_OF(sales HIERARCHY geography_hier LEVEL REGION)) 
  )
DEFAULT MEASURE SALES;</code></pre><p>The SALES_SHR_PARENT_PROD measure calculates the ratio of a SALES value at the CATEGORY or DEPARTMENT level to SALES of the parent in the PRODUCT_HIER hierarchy, such as the ratio of SALES for Total Server Computers to Computers.</p>
                     <p>This query selects SALES and SALES_SHR_PARENT_PROD measure for CY2014 at each level of the PRODUCT_HIER hierarchy.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time,
 product_hier.member_name    AS Product,
 product_hier.level_name     AS Prod_Level,
 sales,
 ROUND(sales_shr_parent_prod,2) AS sales_shr_parent_prod 
FROM
 sales_av HIERARCHIES (time_hier, product_hier)
WHERE time_hier.year_name = 'CY2014'
AND time_hier.level_name = 'YEAR'
ORDER BY product_hier.hier_order;
</code></pre><p>The results of the query are:</p><img src="img/av_calc_meas_share.png" alt="Description of av_calc_meas_share.png follows" title="Description of av_calc_meas_share.png follows" longdesc="img_text/av_calc_meas_share.html"><br><a href="img_text/av_calc_meas_share.html">Description of the illustration av_calc_meas_share.png</a><p>The SALE_SHR_REGION measure calculates the share of SALES at the STATE or COUNTRY levels to SALES at the REGION level, for example, the ratio of SALES for California &#x2013; US to SALES for North America.</p>
                     <p>This query returns the values for the SALES and SALES_SHR_REGION measures for year CY2014 and states in the United States.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name AS Time,
 geography_hier.member_name  AS Geography,
 geography_hier.level_name   AS Geog_Level,
 sales,
 ROUND(sales_shr_region,2)   AS sales_shr_region 
FROM
 sales_av HIERARCHIES (time_hier, geography_hier)
WHERE time_hier.year_name = 'CY2014'
AND time_hier.level_name = 'YEAR'
AND geography_hier.country_name = 'United States'
AND geography_hier.level_name = 'STATE_PROVINCE'
ORDER BY geography_hier.hier_order;
</code></pre><p>This is the result of the query.</p><img src="img/av_calc_meas_share_region.png" alt="Description of av_calc_meas_share_region.png follows" title="Description of av_calc_meas_share_region.png follows" longdesc="img_text/av_calc_meas_share_region.html"><br><a href="img_text/av_calc_meas_share_region.html">Description of the illustration av_calc_meas_share_region.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p class="subhead2">QDR Expressions</p>
                     <p>A <code class="codeph">qdr_expression</code> uses the <code class="codeph">QUALIFY</code> keyword to limit the values of a measure to those for a single dimension member. An example is Sales for the year CY2011 or the percent difference in SALES between the current time period and CY2011.  The <code class="codeph">QUALIFY</code> expression refers to a <code class="codeph">KEY</code> attribute value. 
                     </p>
                     <p>Limits the values of a measure to those for the single dimension members specified by the qualified data reference</p>
                  </div>
                  <!-- class="section" -->
                  <div class="example" id="GUID-79DE1FF2-1E7E-4192-B89A-4E5575EA2529__GUID-7E0C2ECF-9CBC-45CF-BB16-FB34A405CAC9">
                     <p class="titleinexample">Example 26-6 Using QUALIFY Expressions</p>
                     <p>Create the SALES_AV analytic view with the SALES_2011 and SALES_PCT_CHG_2011 measures.</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units,
 -- Sales for CY2011
 sales_2011 AS
    (QUALIFY (sales, time_hier = year['11'])),
  -- Sales percent change from 2011.
  sales_pct_chg_2011 AS
    ((sales - (QUALIFY (sales, time_hier = year['11']))) /
    (QUALIFY (sales, time_hier = year['11'])))
  )
DEFAULT MEASURE SALES;</code></pre><p>Regardless of filters in the query, the SALES_2011 measure always returns data for the year CY2011. The SALES_PCT_CHG_2011 measure calculates the percent difference between the current time period and CY2011.</p>
                     <p>This query selects SALES, SALES_2011 and SALES_PCT_CHG_2011 at the YEAR and REGION levels.</p><pre class="pre codeblock"><code>SELECT time_hier.member_name   AS Time,
 geography_hier.member_name    AS Geography,
 sales,
 sales_2011,
 ROUND(sales_pct_chg_2011,2) as sales_pct_chg_2011
FROM
 sales_av HIERARCHIES (time_hier, geography_hier)
WHERE time_hier.level_name = 'YEAR'
AND geography_hier.level_name = 'REGION'
ORDER BY geography_hier.hier_order,
 time_hier.hier_order;</code></pre><p>This is an excerpt from the query results. Note that for each row SALES_2011 returns SALES for CY2011.</p><img src="img/av_calc_meas_qualify.png" alt="Description of av_calc_meas_qualify.png follows" title="Description of av_calc_meas_qualify.png follows" longdesc="img_text/av_calc_meas_qualify.html"><br><a href="img_text/av_calc_meas_qualify.html">Description of the illustration av_calc_meas_qualify.png</a></div>
                  <!-- class="example" -->
               </div>
            </div>
            <div class="sect2"><a id="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" name="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1"></a><h3 id="DWHSG-GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1" class="sect3"><span class="enumeration_section">26.7 </span>Attribute Reporting
               </h3>
               <div>
                  <p>You can use any attribute of an attribute dimension in a hierarchy and aggregate data for it in an analytic view,.</p>
                  <p>You can use attributes to filter data or to display in a report.  You can also break out (aggregate) data by an attribute. You can create calculated measures in an analytic view using the attribute; the analytic view then provides the aggregate rows for the attribute.</p>
                  <div class="example" id="GUID-8EFF4827-208C-40B0-AFA2-6838BFFEB2C1__GUID-F4434745-B5D1-4B59-91EF-8DEC18202516">
                     <p class="titleinexample">Example 26-7 Using the SEASON Attribute</p>
                     <p>This example first creates an attribute dimension that has SEASON and SEASON_ORDER as attributes. This allows a hierarchy and an analytic view to reuse some metadata of those attributes and to relate the attributes to other levels. For example, SEASON is determined by MONTH values.</p><pre class="pre codeblock"><code>-- Create a time attribute dimension with a SEASON attribute.
CREATE OR REPLACE ATTRIBUTE DIMENSION time_attr_dim
DIMENSION TYPE TIME
USING time_dim
ATTRIBUTES
 (year_id,
  year_name,
  year_end_date,
  quarter_id,
  quarter_name,
  quarter_end_date,
  month_id,
  month_name,
  month_long_name,
  month_end_date,
  season,
  season_order)
LEVEL month
  LEVEL TYPE MONTHS
  KEY month_id
  MEMBER NAME month_name
  MEMBER CAPTION month_name
  MEMBER DESCRIPTION month_long_name
  ORDER BY month_end_date
  DETERMINES (quarter_id, season, season_order)
LEVEL quarter
  LEVEL TYPE QUARTERS
  KEY quarter_id
  MEMBER NAME quarter_name
  MEMBER CAPTION quarter_name
  MEMBER DESCRIPTION quarter_name
  ORDER BY quarter_end_date
  DETERMINES (year_id)
LEVEL year
  LEVEL TYPE YEARS
  KEY year_id
  MEMBER NAME year_name
  MEMBER CAPTION year_name
  MEMBER DESCRIPTION year_name
  ORDER BY year_end_date
LEVEL season
  LEVEL TYPE QUARTERS
  KEY season
  MEMBER NAME season
  MEMBER CAPTION season
  MEMBER DESCRIPTION season
  ORDER BY season_order;</code></pre><p>Create a hierarchy in which MONTH is a child of SEASON.</p><pre class="pre codeblock"><code>CREATE OR REPLACE HIERARCHY time_season_hier
USING time_attr_dim 
  (month CHILD OF
   season);
</code></pre><p>Select data from the TIME_SEASON_HIER hierarchy.</p><pre class="pre codeblock"><code>SELECT member_name,
  member_unique_name,
  level_name,
  hier_order
FROM time_season_hier
ORDER BY hier_order;
</code></pre><p>In the results of the query, the TIME_SEASON_HIER hierarchy returns rows for the ALL level, SEASONS, and MONTHS. This image captures the first twenty of the rows returned.</p><img src="img/av_calc_meas_attr_report.png" alt="Description of av_calc_meas_attr_report.png follows" title="Description of av_calc_meas_attr_report.png follows" longdesc="img_text/av_calc_meas_attr_report.html"><br><a href="img_text/av_calc_meas_attr_report.html">Description of the illustration av_calc_meas_attr_report.png</a><p> The example next creates an analytic view that provides aggregate data for SEASON.</p><pre class="pre codeblock"><code>CREATE OR REPLACE ANALYTIC VIEW sales_av
USING sales_fact
DIMENSION BY
  (time_attr_dim
    KEY month_id REFERENCES month_id
    HIERARCHIES (
      time_hier DEFAULT,
      time_season_hier),
   product_attr_dim
    KEY category_id REFERENCES category_id
    HIERARCHIES (
      product_hier DEFAULT),
   geography_attr_dim
    KEY state_province_id 
    REFERENCES state_province_id
    HIERARCHIES (
      geography_hier DEFAULT)
   )
MEASURES
 (sales FACT sales,
  units FACT units
  )
DEFAULT MEASURE SALES;</code></pre><p>You can now select SALES by YEAR and SEASON directly from the analytic view. This query selects from the TIME_HIER and TIME_SEASON_HIER hierarchies at the YEAR and SEASON levels.</p><pre class="pre codeblock"><code>SELECT  time_hier.member_name      AS Time, 
 time_season_hier.member_name      AS Season,
 ROUND(sales)                      AS Sales
FROM sales_av HIERARCHIES (time_hier, time_season_hier)
WHERE time_hier.level_name = 'YEAR'
  AND time_season_hier.level_name = 'SEASON'
ORDER BY time_hier.hier_order, 
  time_season_hier.hier_order;</code></pre><p>This excerpt from the query results shows the first twelve rows returned.</p><img src="img/av_calc_meas_season_sales.png" alt="Description of av_calc_meas_season_sales.png follows" title="Description of av_calc_meas_season_sales.png follows" longdesc="img_text/av_calc_meas_season_sales.html"><br><a href="img_text/av_calc_meas_season_sales.html">Description of the illustration av_calc_meas_season_sales.png</a></div>
                  <!-- class="example" -->
                  <div class="section">
                     <p>You can view and run the SQL scripts that create the tables, the analytic view component objects, and the queries used in the examples from the Oracle Live SQL website at <a href="https://livesql.oracle.com/apex/livesql/file/index.html">https://livesql.oracle.com/apex/livesql/file/index.html</a>.
                     </p>
                  </div>
                  <!-- class="section" -->
               </div>
            </div>
         </div>
      </article>
   </body>
</html>